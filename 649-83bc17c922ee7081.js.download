!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c441b7d3-8784-48ba-a722-7d3b5b59b4e2",e._sentryDebugIdIdentifier="sentry-dbid-c441b7d3-8784-48ba-a722-7d3b5b59b4e2")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"ef5ff8f4"};"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{10752:(e,t,n)=>{e.exports=n(18319)},18319:(e,t,n)=>{var i=n(2272),r=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===i||void 0===i.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||r.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||r.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||r.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=r.DEFAULT_MAX_PENDING};r.DEFAULT_TIMEOUT=0,r.DEFAULT_MAX_OCCUPATION_TIME=0,r.DEFAULT_MAX_EXECUTION_TIME=0,r.DEFAULT_MAX_PENDING=1e3,r.prototype.acquire=function(e,t,n,r){if(Array.isArray(e))return this._acquireBatch(e,t,n,r);if("function"!=typeof t)throw Error("You must pass a function to execute");var s=null,o=null,a=null;"function"!=typeof n&&(r=n,n=null,a=new this.Promise(function(e,t){s=e,o=t})),r=r||{};var l=!1,c=null,h=null,u=null,d=this,f=function(t,i,r){h&&(clearTimeout(h),h=null),u&&(clearTimeout(u),u=null),t&&(d.queues[e]&&0===d.queues[e].length&&delete d.queues[e],d.domainReentrant&&delete d.domains[e]),l||(a?i?o(i):s(r):"function"==typeof n&&n(i,r),l=!0),t&&d.queues[e]&&d.queues[e].length>0&&d.queues[e].shift()()},p=function(n){if(l)return f(n);c&&(clearTimeout(c),c=null),d.domainReentrant&&n&&(d.domains[e]=i.domain);var s=r.maxExecutionTime||d.maxExecutionTime;if(s&&(u=setTimeout(function(){d.queues[e]&&f(n,Error("Maximum execution time is exceeded "+e))},s)),1===t.length){var o=!1;try{t(function(e,t){o||(o=!0,f(n,e,t))})}catch(e){o||(o=!0,f(n,e))}}else d._promiseTry(function(){return t()}).then(function(e){f(n,void 0,e)},function(e){f(n,e)})};d.domainReentrant&&i.domain&&(p=i.domain.bind(p));var g=r.maxPending||d.maxPending;if(d.queues[e])if(d.domainReentrant&&i.domain&&i.domain===d.domains[e])p(!1);else if(d.queues[e].length>=g)f(!1,Error("Too many pending tasks in queue "+e));else{var y=function(){p(!0)};r.skipQueue?d.queues[e].unshift(y):d.queues[e].push(y);var m=r.timeout||d.timeout;m&&(c=setTimeout(function(){c=null,f(!1,Error("async-lock timed out in queue "+e))},m))}else d.queues[e]=[],p(!0);var v=r.maxOccupationTime||d.maxOccupationTime;if(v&&(h=setTimeout(function(){d.queues[e]&&f(!1,Error("Maximum occupation time is exceeded in queue "+e))},v)),a)return a},r.prototype._acquireBatch=function(e,t,n,i){"function"!=typeof n&&(i=n,n=null);var r=this,s=e.reduceRight(function(e,t){return function(n){r.acquire(t,e,n,i)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===s.length?s(function(n,i){n?t(n):e(i)}):e(s())});s(n)},r.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},r.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},e.exports=r},36641:(e,t,n)=>{n.d(t,{M:()=>T});var i=new TextEncoder;function r(e,t,n){for(var i=t,r=i+n,s=[],o="";i<r;){var a=e[i++];if((128&a)==0)s.push(a);else if((224&a)==192){var l=63&e[i++];s.push((31&a)<<6|l)}else if((240&a)==224){var l=63&e[i++],c=63&e[i++];s.push((31&a)<<12|l<<6|c)}else if((248&a)==240){var l=63&e[i++],c=63&e[i++],h=(7&a)<<18|l<<12|c<<6|63&e[i++];h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|1023&h),s.push(h)}else s.push(a);s.length>=4096&&(o+=String.fromCharCode.apply(String,s),s.length=0)}return s.length>0&&(o+=String.fromCharCode.apply(String,s)),o}var s=new TextDecoder,o=function(e,t){this.type=e,this.data=t},a=function(){var e=function(t,n){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),l=function(e){function t(n){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,Object.create(t.prototype)),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:t.name}),i}return a(t,e),t}(Error);function c(e,t,n){var i=Math.floor(n/0x100000000);e.setUint32(t,i),e.setUint32(t+4,n)}function h(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}var u={type:-1,encode:function(e){var t,n,i,r;return e instanceof Date?function(e){var t=e.sec,n=e.nsec;if(t>=0&&n>=0&&t<=0x3ffffffff)if(0===n&&t<=0xffffffff){var i=new Uint8Array(4),r=new DataView(i.buffer);return r.setUint32(0,t),i}else{var s=t/0x100000000,i=new Uint8Array(8),r=new DataView(i.buffer);return r.setUint32(0,n<<2|3&s),r.setUint32(4,0|t),i}var i=new Uint8Array(12),r=new DataView(i.buffer);return r.setUint32(0,n),c(r,4,t),i}((n=Math.floor((t=e.getTime())/1e3),r=Math.floor((i=(t-1e3*n)*1e6)/1e9),{sec:n+r,nsec:i-1e9*r})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var n=t.getUint32(0),i=0;return{sec:n,nsec:0};case 8:var r=t.getUint32(0),n=(3&r)*0x100000000+t.getUint32(4),i=r>>>2;return{sec:n,nsec:i};case 12:var n=h(t,4),i=t.getUint32(0);return{sec:n,nsec:i};default:throw new l("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},d=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(u)}return e.prototype.register=function(e){var t=e.type,n=e.encode,i=e.decode;if(t>=0)this.encoders[t]=n,this.decoders[t]=i;else{var r=1+t;this.builtInEncoders[r]=n,this.builtInDecoders[r]=i}},e.prototype.tryToEncode=function(e,t){for(var n=0;n<this.builtInEncoders.length;n++){var i=this.builtInEncoders[n];if(null!=i){var r=i(e,t);if(null!=r){var s=-1-n;return new o(s,r)}}}for(var n=0;n<this.encoders.length;n++){var i=this.encoders[n];if(null!=i){var r=i(e,t);if(null!=r){var s=n;return new o(s,r)}}}return e instanceof o?e:null},e.prototype.decode=function(e,t,n){var i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,n):new o(t,e)},e.defaultCodec=new e,e}();function f(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var p=function(){function e(e){var t,n,i,r,s,o,a,l;this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:d.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxDepth=null!=(i=null==e?void 0:e.maxDepth)?i:100,this.initialBufferSize=null!=(r=null==e?void 0:e.initialBufferSize)?r:2048,this.sortKeys=null!=(s=null==e?void 0:e.sortKeys)&&s,this.forceFloat32=null!=(o=null==e?void 0:e.forceFloat32)&&o,this.ignoreUndefined=null!=(a=null==e?void 0:e.ignoreUndefined)&&a,this.forceIntegerToFloat=null!=(l=null==e?void 0:e.forceIntegerToFloat)&&l,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),n=new Uint8Array(t),i=new DataView(t);n.set(this.bytes),this.view=i,this.bytes=n},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)},e.prototype.encodeNumberAsFloat=function(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.encodeBigInt64=function(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){var t=function(e){for(var t=e.length,n=0,i=0;i<t;){var r=e.charCodeAt(i++);if((0xffffff80&r)==0){n++;continue}if((0xfffff800&r)==0)n+=2;else{if(r>=55296&&r<=56319&&i<t){var s=e.charCodeAt(i);(64512&s)==56320&&(++i,r=((1023&r)<<10)+(1023&s)+65536)}(0xffff0000&r)==0?n+=3:n+=4}}return n}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,n){if(e.length>50)i.encodeInto(e,t.subarray(n));else!function(e,t,n){for(var i=e.length,r=n,s=0;s<i;){var o=e.charCodeAt(s++);if((0xffffff80&o)==0){t[r++]=o;continue}if((0xfffff800&o)==0)t[r++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){var a=e.charCodeAt(s);(64512&a)==56320&&(++s,o=((1023&o)<<10)+(1023&a)+65536)}(0xffff0000&o)==0?t[r++]=o>>12&15|224:(t[r++]=o>>18&7|240,t[r++]=o>>12&63|128),t[r++]=o>>6&63|128}t[r++]=63&o|128}}(e,t,n)}(e,this.bytes,this.pos),this.pos+=t},e.prototype.encodeObject=function(e,t){var n=this.extensionCodec.tryToEncode(e,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var n=f(e);this.writeU8a(n)},e.prototype.encodeArray=function(e,t){var n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<0x100000000)this.writeU8(221),this.writeU32(n);else throw Error("Too large array: ".concat(n));for(var i=0;i<e.length;i++){var r=e[i];this.doEncode(r,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var n=0,i=0;i<t.length;i++)void 0!==e[t[i]]&&n++;return n},e.prototype.encodeMap=function(e,t){var n=Object.keys(e);this.sortKeys&&n.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<0x100000000)this.writeU8(223),this.writeU32(i);else throw Error("Too large map object: ".concat(i));for(var r=0;r<n.length;r++){var s=n[r],o=e[s];this.ignoreUndefined&&void 0===o||(this.encodeString(s),this.doEncode(o,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,n;this.ensureBufferSizeToWrite(8),t=this.view,n=this.pos,t.setUint32(n,e/0x100000000),t.setUint32(n+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),c(this.view,this.pos,e),this.pos+=8},e.prototype.writeBigUint64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8},e.prototype.writeBigInt64=function(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8},e}();function g(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var y=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,n){var i=this.caches[n-1];e:for(var r=0;r<i.length;r++){for(var s=i[r],o=s.bytes,a=0;a<n;a++)if(o[a]!==e[t+a])continue e;return s.str}return null},e.prototype.store=function(e,t){var n=this.caches[e.length-1],i={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)},e.prototype.decode=function(e,t,n){var i=this.find(e,t,n);if(null!=i)return this.hit++,i;this.miss++;var s=r(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,s),s},e}(),m=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){var c=[a,l];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,i=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){o.label=c[1];break}if(6===c[0]&&o.label<r[1]){o.label=r[1],r=c;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(c);break}r[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],i=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},v=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){var s,o,a;s=i,o=r,a=(t=e[n](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:a})},o)})}}},w=function(e){return this instanceof w?(this.v=e,this):new w(e)},b=function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){r[e]&&(i[e]=function(t){return new Promise(function(n,i){s.push([e,t,n,i])>1||a(e,t)})})}function a(e,t){try{var n;(n=r[e](t)).value instanceof w?Promise.resolve(n.value.v).then(l,c):h(s[0][2],n)}catch(e){h(s[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function h(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},E="array",x="map_key",k=new DataView(new ArrayBuffer(0)),S=new Uint8Array(k.buffer);try{k.getInt8(0)}catch(e){if(!(e instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var M=RangeError,C=new M("Insufficient data"),_=new y,U=function(){function e(e){var t,n,i,r,s,o,a;this.totalPos=0,this.pos=0,this.view=k,this.bytes=S,this.headByte=-1,this.stack=[],this.extensionCodec=null!=(t=null==e?void 0:e.extensionCodec)?t:d.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=null!=(n=null==e?void 0:e.useBigInt64)&&n,this.maxStrLength=null!=(i=null==e?void 0:e.maxStrLength)?i:0xffffffff,this.maxBinLength=null!=(r=null==e?void 0:e.maxBinLength)?r:0xffffffff,this.maxArrayLength=null!=(s=null==e?void 0:e.maxArrayLength)?s:0xffffffff,this.maxMapLength=null!=(o=null==e?void 0:e.maxMapLength)?o:0xffffffff,this.maxExtLength=null!=(a=null==e?void 0:e.maxExtLength)?a:0xffffffff,this.keyDecoder=(null==e?void 0:e.keyDecoder)!==void 0?e.keyDecoder:_}return e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=f(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=f(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),n=f(e),i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),this.setBuffer(i)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,n=this.pos;return RangeError("Extra ".concat(t.byteLength-n," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return m(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,n,i,r,s,o,a,l,c,h,u;return l=this,c=void 0,h=void 0,u=function(){var l,c,h,u,d,f,p;return m(this,function(y){switch(y.label){case 0:l=!1,y.label=1;case 1:y.trys.push([1,6,7,12]),t=!0,n=v(e),y.label=2;case 2:return[4,n.next()];case 3:if(r=(i=y.sent()).done)return[3,5];a=i.value,t=!1;try{if(h=a,l)throw this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{c=this.doDecodeSync(),l=!0}catch(e){if(!(e instanceof M))throw e}this.totalPos+=this.pos}finally{t=!0}y.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return s={error:y.sent()},[3,12];case 7:if(y.trys.push([7,,10,11]),!(!t&&!r&&(o=n.return)))return[3,9];return[4,o.call(n)];case 8:y.sent(),y.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(l){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,c]}throw u=this,d=u.headByte,f=u.pos,p=u.totalPos,RangeError("Insufficient data in parsing ".concat(g(d)," at ").concat(p," (").concat(f," in the current buffer)"))}})},new(h||(h=Promise))(function(e,t){function n(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):((r=t.value)instanceof h?r:new h(function(e){e(r)})).then(n,i)}r((u=u.apply(l,c||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return b(this,arguments,function(){var n,i,r,s,o,a,l,c,h,u,d;return m(this,function(f){switch(f.label){case 0:n=t,i=-1,f.label=1;case 1:f.trys.push([1,15,16,21]),r=!0,s=v(e),f.label=2;case 2:return[4,w(s.next())];case 3:if(c=(o=f.sent()).done)return[3,14];d=o.value,r=!1,f.label=4;case 4:if(f.trys.push([4,,12,13]),a=d,t&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(i=this.readArraySize(),n=!1,this.complete()),f.label=5;case 5:f.trys.push([5,10,,11]),f.label=6;case 6:return[4,w(this.doDecodeSync())];case 7:return[4,f.sent()];case 8:if(f.sent(),0==--i)return[3,9];return[3,6];case 9:return[3,11];case 10:if(!((l=f.sent())instanceof M))throw l;return[3,11];case 11:return this.totalPos+=this.pos,[3,13];case 12:return r=!0,[7];case 13:return[3,2];case 14:return[3,21];case 15:return h={error:f.sent()},[3,21];case 16:if(f.trys.push([16,,19,20]),!(!r&&!c&&(u=s.return)))return[3,18];return[4,w(u.call(s))];case 17:f.sent(),f.label=18;case 18:return[3,20];case 19:if(h)throw h.error;return[7];case 20:return[7];case 21:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var n=e-128;if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(e<160){var n=e-144;if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else{var i=e-160;t=this.decodeUtf8String(i,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){var i=this.lookU8();t=this.decodeUtf8String(i,1)}else if(218===e){var i=this.lookU16();t=this.decodeUtf8String(i,2)}else if(219===e){var i=this.lookU32();t=this.decodeUtf8String(i,4)}else if(220===e){var n=this.readU16();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(221===e){var n=this.readU32();if(0!==n){this.pushArrayState(n),this.complete();continue}t=[]}else if(222===e){var n=this.readU16();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(223===e){var n=this.readU32();if(0!==n){this.pushMapState(n),this.complete();continue}t={}}else if(196===e){var n=this.lookU8();t=this.decodeBinary(n,1)}else if(197===e){var n=this.lookU16();t=this.decodeBinary(n,2)}else if(198===e){var n=this.lookU32();t=this.decodeBinary(n,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var n=this.lookU8();t=this.decodeExtension(n,1)}else if(200===e){var n=this.lookU16();t=this.decodeExtension(n,2)}else if(201===e){var n=this.lookU32();t=this.decodeExtension(n,4)}else throw new l("Unrecognized type byte: ".concat(g(e)));this.complete();for(var r=this.stack;r.length>0;){var s,o=r[r.length-1];if(o.type===E)if(o.array[o.position]=t,o.position++,o.position===o.size)r.pop(),t=o.array;else continue t;else if(o.type===x){if("string"!=typeof(s=t)&&"number"!=typeof s)throw new l("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new l("The key __proto__ is not allowed");o.key=t,o.type="map_value";continue t}else if(o.map[o.key]=t,o.readCount++,o.readCount===o.size)r.pop(),t=o.map;else{o.key=null,o.type=x;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new l("Unrecognized array type byte: ".concat(g(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new l("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:x,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new l("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:E,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new l("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw C;var n,i,o=this.pos+t;return i=this.stateIsMapKey()&&(null==(n=this.keyDecoder)?void 0:n.canBeCached(e))?this.keyDecoder.decode(this.bytes,o,e):function(e,t,n){var i;return n>200?(i=e.subarray(t,t+n),s.decode(i)):r(e,t,n)}(this.bytes,o,e),this.pos+=t+e,i},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&this.stack[this.stack.length-1].type===x},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new l("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw C;var n=this.pos+t,i=this.bytes.subarray(n,n+e);return this.pos+=t+e,i},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new l("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,n,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,n=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,n},e.prototype.readI64=function(){var e=h(this.view,this.pos);return this.pos+=8,e},e.prototype.readU64AsBigInt=function(){var e=this.view.getBigUint64(this.pos);return this.pos+=8,e},e.prototype.readI64AsBigInt=function(){var e=this.view.getBigInt64(this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},e}(),T={toBuffer:e=>new p({ignoreUndefined:!0}).encodeSharedRef(e),fromBuffer:e=>{try{let t=new U(void 0).decode(e);if("object"!=typeof t)return null;return t}catch{return null}}}},37591:(e,t,n)=>{n.d(t,{Ng:()=>d,bd:()=>c,oK:()=>u}),n(95570);var i={debug:-1,info:0,warn:1,error:2},r=e=>(t,n)=>{if(!n?.transportMessage)return void e(t,n);let{payload:i,...r}=n.transportMessage;n.transportMessage=r,e(t,n)},s=class{minLevel;output;constructor(e,t="info"){this.minLevel=t,this.output=e}debug(e,t){i[this.minLevel]<=i.debug&&this.output(e,t??{},"debug")}info(e,t){i[this.minLevel]<=i.info&&this.output(e,t??{},"info")}warn(e,t){i[this.minLevel]<=i.warn&&this.output(e,t??{},"warn")}error(e,t){i[this.minLevel]<=i.error&&this.output(e,t??{},"error")}},o=e=>({debug:r(e.debug.bind(e)),info:r(e.info.bind(e)),warn:r(e.warn.bind(e)),error:r(e.error.bind(e))}),a=n(38325),l=n(99706),c={RetriesExceeded:"conn_retry_exceeded",HandshakeFailed:"handshake_failed",MessageOrderingViolated:"message_ordering_violated",InvalidMessage:"invalid_message"},h=class{eventListeners={};removeAllListeners(){this.eventListeners={}}numberOfListeners(e){return this.eventListeners[e]?.size??0}addEventListener(e,t){this.eventListeners[e]||(this.eventListeners[e]=new Set),this.eventListeners[e]?.add(t)}removeEventListener(e,t){this.eventListeners[e]&&this.eventListeners[e]?.delete(t)}dispatchEvent(e,t){let n=this.eventListeners[e];if(n)for(let e of[...n])e(t)}},u=class{status;clientId;eventDispatcher;options;log;sessions;constructor(e,t){this.options={...a.jw,...t},this.eventDispatcher=new h,this.clientId=e,this.status="open",this.sessions=new Map}bindLogger(e,t){if("function"==typeof e){this.log=o(new s(e,t));return}this.log=o(e)}handleMsg(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}protocolError(e){this.eventDispatcher.dispatchEvent("protocolError",e)}close(){for(let e of(this.status="closed",this.sessions.values()))this.deleteSession(e);this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),this.log?.info("manually closed transport",{clientId:this.clientId})}getStatus(){return this.status}updateSession(e){let t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error(`attempt to transition active session for ${e.to} but active session (${t.id}) is different from handle (${e.id})`);return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}deleteSession(e,t){if(e._isConsumed)return;let n=e.loggingMetadata;n.tags&&t?.unhealthy&&n.tags.push("unhealthy-session"),e.log?.info(`closing session ${e.id}`,n),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});let i=e.to;e.close(),this.sessions.delete(i)}onSessionGracePeriodElapsed(e){this.log?.warn(`session to ${e.to} grace period elapsed, closing`,e.loggingMetadata),this.deleteSession(e)}onConnectingFailed(e){let t=a.CC.transition.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}});return this.updateSession(t)}onConnClosed(e){let t;return t="Handshaking"===e.state?a.CC.transition.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}):a.CC.transition.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}},d=class{id;telemetry;constructor(){this.id=`conn-${(0,l.$C)()}`}get loggingMetadata(){let e={connId:this.id},t=this.telemetry?.span.spanContext();return this.telemetry?.span.isRecording()&&t&&(e.telemetry={traceId:t.traceId,spanId:t.spanId}),e}_dataListeners=new Set;_closeListeners=new Set;_errorListeners=new Set;get dataListeners(){return[...this._dataListeners]}get closeListeners(){return[...this._closeListeners]}get errorListeners(){return[...this._errorListeners]}addDataListener(e){this._dataListeners.add(e)}removeDataListener(e){this._dataListeners.delete(e)}addCloseListener(e){this._closeListeners.add(e)}removeCloseListener(e){this._closeListeners.delete(e)}addErrorListener(e){this._errorListeners.add(e)}removeErrorListener(e){this._errorListeners.delete(e)}}},38325:(e,t,n)=>{n.d(t,{Dl:()=>U,CC:()=>C,I$:()=>u,jw:()=>h});var i=n(99706),r=new TextEncoder,s=new TextDecoder,o=n(97858),a=n(16128),l=n(63650),c=n(64254).hp,h={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:e=>r.encode(JSON.stringify(e,function(e){let t,n=this[e];if(!(n instanceof Uint8Array))return n;return{$t:(t="",n.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t))}})),fromBuffer:e=>{try{let t=JSON.parse(s.decode(e),function(e,t){return t?.$t?function(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(t.$t):t});if("object"==typeof t)return t;return null}catch{return null}}}},u={...h,baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200};({...h});var d=(e=>(e.NoConnection="NoConnection",e.BackingOff="BackingOff",e.Connecting="Connecting",e.Handshaking="Handshaking",e.Connected="Connected",e.WaitingForHandshake="WaitingForHandshake",e))(d||{}),f="session state has been consumed and is no longer valid",p=class{_isConsumed;close(){this._handleClose()}constructor(){return this._isConsumed=!1,new Proxy(this,{get(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return()=>{e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return()=>{e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error(`${f}: getting ${t.toString()} on consumed state`);return Reflect.get(e,t)},set(e,t,n){if(e._isConsumed)throw Error(`${f}: setting ${t.toString()} on consumed state`);return Reflect.set(e,t,n)}})}},g=class extends p{from;options;log;constructor({from:e,options:t,log:n}){super(),this.from=e,this.options=t,this.log=n}parseMsg(e){let t=this.options.codec.fromBuffer(e);if(null===t){let t=new TextDecoder().decode(c.from(e));return this.log?.error(`received malformed msg: ${t}`,this.loggingMetadata),null}return o.J(i.bH,t)?t:(this.log?.error(`received invalid msg: ${JSON.stringify(t)}`,{...this.loggingMetadata,validationErrors:[...a.I(i.bH,t)]}),null)}},y=class extends g{id;telemetry;to;seq;ack;sendBuffer;constructor(e){let{id:t,to:n,seq:i,ack:r,sendBuffer:s,telemetry:o,log:a}=e;super(e),this.id=t,this.to=n,this.seq=i,this.ack=r,this.sendBuffer=s,this.telemetry=o,this.log=a}get loggingMetadata(){let e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}constructMsg(e){let t={...e,id:(0,i.$C)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack};return this.seq++,t}nextSeq(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}_handleStateExit(){}_handleClose(){this.sendBuffer.length=0,this.telemetry.span.end()}},m=class extends y{graceExpiryTime;gracePeriodTimeout;listeners;constructor(e){super(e),this.listeners=e.listeners,this.graceExpiryTime=e.graceExpiryTime,this.gracePeriodTimeout=setTimeout(()=>{this.listeners.onSessionGracePeriodElapsed()},this.graceExpiryTime-Date.now())}_handleStateExit(){super._handleStateExit(),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}_handleClose(){super._handleClose()}},v=class extends m{state="Connecting";connPromise;listeners;connectionTimeout;constructor(e){super(e),this.connPromise=e.connPromise,this.listeners=e.listeners,this.connPromise.then(e=>{this._isConsumed||this.listeners.onConnectionEstablished(e)},e=>{this._isConsumed||this.listeners.onConnectionFailed(e)}),this.connectionTimeout=setTimeout(()=>{this.listeners.onConnectionTimeout()},this.options.connectionTimeoutMs)}bestEffortClose(){let e=this.log,t=this.loggingMetadata;this.connPromise.then(n=>{n.close(),e?.info("connection eventually resolved but session has transitioned, closed connection",{...t,...n.loggingMetadata})}).catch(()=>{})}_handleStateExit(){super._handleStateExit(),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}_handleClose(){this.bestEffortClose(),super._handleClose()}},w=class extends m{state="NoConnection";_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit()}},b=class extends g{state="WaitingForHandshake";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.addDataListener(this.onHandshakeData),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.conn.addCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{clientId:this.from,connId:this.conn.id,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE");this.listeners.onHandshake(t)};sendHandshake(e){return this.conn.send(this.options.codec.toBuffer(e))}_handleStateExit(){this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0}_handleClose(){this.conn.close()}},E=class extends m{state="Handshaking";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.addDataListener(this.onHandshakeData),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.conn.addCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE");this.listeners.onHandshake(t)};sendHandshake(e){return this.conn.send(this.options.codec.toBuffer(e))}_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},x=class extends y{state="Connected";conn;listeners;heartbeatHandle;heartbeatMisses=0;isActivelyHeartbeating;updateBookkeeping(e,t){this.sendBuffer=this.sendBuffer.filter(t=>t.seq>=e),this.ack=t+1,this.heartbeatMisses=0}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}constructor(e){if(super(e),this.conn=e.conn,this.listeners=e.listeners,this.conn.addDataListener(this.onMessageData),this.conn.addCloseListener(this.listeners.onConnectionClosed),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.sendBuffer.length>0)for(let e of(this.log?.info(`sending ${this.sendBuffer.length} buffered messages, starting at seq ${this.nextSeq()}`,this.loggingMetadata),this.sendBuffer))this.conn.send(this.options.codec.toBuffer(e));this.isActivelyHeartbeating=!1,this.heartbeatHandle=setInterval(()=>{let e=this.heartbeatMisses,t=e*this.options.heartbeatIntervalMs;if(e>=this.options.heartbeatsUntilDead){this.log?.info(`closing connection to ${this.to} due to inactivity (missed ${e} heartbeats which is ${t}ms)`,this.loggingMetadata),this.telemetry.span.addEvent("closing connection due to inactivity"),this.conn.close(),clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0;return}this.isActivelyHeartbeating&&this.sendHeartbeat(),this.heartbeatMisses++},this.options.heartbeatIntervalMs)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}startActiveHeartbeat(){this.isActivelyHeartbeating=!0}sendHeartbeat(){this.log?.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}closeConnection(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}onMessageData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidMessage("could not parse message");if(t.seq!==this.ack){if(t.seq<this.ack)this.log?.debug(`received duplicate msg (got seq: ${t.seq}, wanted seq: ${this.ack}), discarding`,{...this.loggingMetadata,transportMessage:t});else{let e=`received out-of-order msg, closing connection (got seq: ${t.seq}, wanted seq: ${this.ack})`;this.log?.warn(e,{...this.loggingMetadata,transportMessage:t,tags:["invariant-violation"]}),this.telemetry.span.setStatus({code:l.s.ERROR,message:e}),this.closeConnection()}return}if(this.log?.debug("received msg",{...this.loggingMetadata,transportMessage:t}),this.updateBookkeeping(t.ack,t.seq),!(0,i.o0)(t.controlFlags))return void this.listeners.onMessage(t);this.log?.debug("discarding msg (ack bit set)",{...this.loggingMetadata,transportMessage:t}),this.isActivelyHeartbeating||this.sendHeartbeat()};_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},k=class extends m{state="BackingOff";listeners;backoffTimeout;constructor(e){super(e),this.listeners=e.listeners,this.backoffTimeout=setTimeout(()=>{this.listeners.onBackoffFinished()},e.backoffMs)}_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit(),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}};function S(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function M(e){return{...S(e),graceExpiryTime:e.graceExpiryTime}}var C={entrypoints:{NoConnection:(e,t,n,r,s)=>{let o=`session-${(0,i.$C)()}`,a=(0,i.iH)(o,e,t),l=new w({listeners:n,id:o,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+r.sessionDisconnectGraceMs,sendBuffer:[],telemetry:a,options:r,log:s});return l.log?.info(`session ${l.id} created in NoConnection state`,{...l.loggingMetadata,tags:["state-transition"]}),l},WaitingForHandshake:(e,t,n,i,r)=>{let s=new b({conn:t,listeners:n,from:e,options:i,log:r});return s.log?.info("session created in WaitingForHandshake state",{...s.loggingMetadata,tags:["state-transition"]}),s}},transition:{NoConnectionToBackingOff:(e,t,n)=>{let i=M(e);e._handleStateExit();let r=new k({backoffMs:t,listeners:n,...i});return r.log?.info(`session ${r.id} transition from NoConnection to BackingOff`,{...r.loggingMetadata,tags:["state-transition"]}),r},BackingOffToConnecting:(e,t,n)=>{let i=M(e);e._handleStateExit();let r=new v({connPromise:t,listeners:n,...i});return r.log?.info(`session ${r.id} transition from BackingOff to Connecting`,{...r.loggingMetadata,tags:["state-transition"]}),r},ConnectingToHandshaking:(e,t,n)=>{let i=M(e);e._handleStateExit();let r=new E({conn:t,listeners:n,...i});return r.log?.info(`session ${r.id} transition from Connecting to Handshaking`,{...r.loggingMetadata,tags:["state-transition"]}),r},HandshakingToConnected:(e,t)=>{let n=S(e),i=e.conn;e._handleStateExit();let r=new x({conn:i,listeners:t,...n});return r.log?.info(`session ${r.id} transition from Handshaking to Connected`,{...r.loggingMetadata,tags:["state-transition"]}),r},WaitingForHandshakeToConnected:(e,t,n,r,s,o)=>{let a=e.conn,{from:l,options:c}=e,h=t?S(t):{id:n,from:l,to:r,seq:0,ack:0,sendBuffer:[],telemetry:(0,i.iH)(n,r,l,s),options:c,log:e.log};e._handleStateExit(),t?._handleStateExit();let u=new x({conn:a,listeners:o,...h});return u.log?.info(`session ${u.id} transition from WaitingForHandshake to Connected`,{...u.loggingMetadata,tags:["state-transition"]}),u},BackingOffToNoConnection:(e,t)=>{let n=M(e);e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from BackingOff to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectingToNoConnection:(e,t)=>{let n=M(e);e.bestEffortClose(),e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Connecting to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},HandshakingToNoConnection:(e,t)=>{let n=M(e);e.conn.close(),e._handleStateExit();let i=new w({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Handshaking to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectedToNoConnection:(e,t)=>{let n=S(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();let r=new w({listeners:t,graceExpiryTime:i,...n});return r.log?.info(`session ${r.id} transition from Connected to NoConnection`,{...r.loggingMetadata,tags:["state-transition"]}),r}}},_=C.transition,U={entrypoint:C.entrypoints.NoConnection,transition:{NoConnectionToBackingOff:_.NoConnectionToBackingOff,BackingOffToConnecting:_.BackingOffToConnecting,ConnectingToHandshaking:_.ConnectingToHandshaking,HandshakingToConnected:_.HandshakingToConnected,BackingOffToNoConnection:_.BackingOffToNoConnection,ConnectingToNoConnection:_.ConnectingToNoConnection,HandshakingToNoConnection:_.HandshakingToNoConnection,ConnectedToNoConnection:_.ConnectedToNoConnection}};C.entrypoints.WaitingForHandshake,_.WaitingForHandshakeToConnected,_.ConnectedToNoConnection},42028:(e,t,n)=>{n.d(t,{T:()=>m});var i=n(91601),r=n(80029),s=n(37609),o=n(80031),a=n(69094),l=n(83850),c=n(97858),h=n(99410),u=n(93294);class d extends s.i{constructor(e,t,n){super("Unable to decode value as it does not match the expected schema"),this.schema=e,this.value=t,this.error=n}}class f extends s.i{constructor(e,t,n,i){super(i instanceof Error?i.message:"Unknown error"),this.schema=e,this.path=t,this.value=n,this.error=i}}function p(e,t,n){try{return(0,u.n_)(e)?e[r.H7].Decode(n):n}catch(i){throw new f(e,t,n,i)}}let g=new Set;var y=n(16128);function m(...e){let[t,n,s]=3===e.length?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!(0,c.J)(t,n,s))throw new d(t,s,(0,y.I)(t,n,s).First());return(g.clear(),function e(t,n){let i=(0,l.uN)(t,n);if(t.$id&&g.has(t.$id))return!1;switch(t.$id&&g.add(t.$id),t[r.b8]){case"Array":case"AsyncIterator":case"Iterator":return(0,u.n_)(t)||e(t.items,i);case"Constructor":return(0,u.n_)(t)||e(t.returns,i)||t.parameters.some(t=>e(t,i));case"Function":return(0,u.n_)(t)||e(t.returns,i)||t.parameters.some(t=>e(t,i));case"Import":let s=globalThis.Object.getOwnPropertyNames(t.$defs).reduce((e,n)=>[...e,t.$defs[n]],[]),o=t.$defs[t.$ref];return(0,u.n_)(t)||e(o,[...s,...i]);case"Intersect":return(0,u.n_)(t)||(0,u.n_)(t.unevaluatedProperties)||t.allOf.some(t=>e(t,i));case"Not":return(0,u.n_)(t)||e(t.not,i);case"Object":return(0,u.n_)(t)||Object.values(t.properties).some(t=>e(t,i))||(0,u.Yi)(t.additionalProperties)&&e(t.additionalProperties,i);case"Promise":return(0,u.n_)(t)||e(t.item,i);case"Record":let a=Object.getOwnPropertyNames(t.patternProperties)[0],c=t.patternProperties[a];return(0,u.n_)(t)||e(c,i)||(0,u.Yi)(t.additionalProperties)&&(0,u.n_)(t.additionalProperties);case"Ref":case"This":return!!(0,u.n_)(t)||e((0,l.Lk)(t,i),i);case"Tuple":return(0,u.n_)(t)||!(0,h.R1)(t.items)&&t.items.some(t=>e(t,i));case"Union":return(0,u.n_)(t)||t.anyOf.some(t=>e(t,i));default:return(0,u.n_)(t)}}(t,n))?function e(t,n,s,d){let f=(0,l.uN)(t,n);switch(t[r.b8]){case"Array":return(0,h.QS)(d)?p(t,s,d.map((n,i)=>e(t.items,f,`${s}/${i}`,n))):p(t,s,d);case"Import":let g=globalThis.Object.values(t.$defs),y=e(t.$defs[t.$ref],[...f,...g],s,d);return p(t,s,y);case"Intersect":return function(t,n,i,r){if(!(0,h.av)(r)||(0,h.u$)(r))return p(t,i,r);let s=function(e){let t=(0,a.g)(e),n=(0,o.u$)(e,t);return t.map((e,i)=>[t[i],n[i]])}(t),l=s.map(e=>e[0]),c={...r};for(let[t,r]of s)t in c&&(c[t]=e(r,n,`${i}/${t}`,c[t]));if(!(0,u.n_)(t.unevaluatedProperties))return p(t,i,c);let d=Object.getOwnPropertyNames(c),f=t.unevaluatedProperties,g={...c};for(let e of d)l.includes(e)||(g[e]=p(f,`${i}/${e}`,g[e]));return p(t,i,g)}(t,f,s,d);case"Not":return p(t,s,e(t.not,f,s,d));case"Object":return function(t,n,r,s){if(!(0,h.av)(s))return p(t,r,s);let o=(0,a.g)(t),l={...s};for(let s of o)(0,h.LT)(l,s)&&((0,h.R1)(l[s])&&(!(0,u.R1)(t.properties[s])||i.Q.IsExactOptionalProperty(l,s))||(l[s]=e(t.properties[s],n,`${r}/${s}`,l[s])));if(!(0,u.Yi)(t.additionalProperties))return p(t,r,l);let c=Object.getOwnPropertyNames(l),d=t.additionalProperties,f={...l};for(let e of c)o.includes(e)||(f[e]=p(d,`${r}/${e}`,f[e]));return p(t,r,f)}(t,f,s,d);case"Record":return function(t,n,i,r){if(!(0,h.av)(r))return p(t,i,r);let s=Object.getOwnPropertyNames(t.patternProperties)[0],o=new RegExp(s),a={...r};for(let l of Object.getOwnPropertyNames(r))o.test(l)&&(a[l]=e(t.patternProperties[s],n,`${i}/${l}`,a[l]));if(!(0,u.Yi)(t.additionalProperties))return p(t,i,a);let l=Object.getOwnPropertyNames(a),c=t.additionalProperties,d={...a};for(let e of l)o.test(e)||(d[e]=p(c,`${i}/${e}`,d[e]));return p(t,i,d)}(t,f,s,d);case"Ref":let m=(0,l.Lk)(t,f);return p(t,s,e(m,f,s,d));case"Symbol":default:return p(t,s,d);case"This":let v=(0,l.Lk)(t,f);return p(t,s,e(v,f,s,d));case"Tuple":return(0,h.QS)(d)&&(0,h.QS)(t.items)?p(t,s,t.items.map((t,n)=>e(t,f,`${s}/${n}`,d[n]))):p(t,s,d);case"Union":for(let n of t.anyOf){if(!(0,c.J)(n,f,d))continue;let i=e(n,f,s,d);return p(t,s,i)}return p(t,s,d)}}(t,n,"",s):s}},46434:(e,t,n)=>{function i(e){var t,n,i,s=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);s--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new r(t.call(e));n="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function r(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(r=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new r(e)}n.d(t,{_:()=>i})},47477:(e,t,n)=>{n.d(t,{eu:()=>o}),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let i=Error("request for lock canceled");class r{constructor(e,t=i){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((n,i)=>{let r={resolve:n,reject:i,weight:e,priority:t},o=s(this._queue,e=>t<=e.priority);-1===o&&e<=this._value?this._dispatchItem(r):this._queue.splice(o+1,0,r)})}runExclusive(e){var t,n,i,r;return t=this,n=arguments,i=void 0,r=function*(e,t=1,n=0){let[i,r]=yield this.acquire(t,n);try{return yield e(i)}finally{r()}},new(i||(i=Promise))(function(e,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):((n=t.value)instanceof i?n:new i(function(e){e(n)})).then(o,a)}l((r=r.apply(t,n||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),function(e,t){let n=s(e,e=>t.priority<=e.priority);e.splice(n+1,0,t)}(this._weightedWaiters[e-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let n=this._weightedWaiters[t-1];if(!n)continue;let i=n.findIndex(t=>t.priority<=e);(-1===i?n:n.splice(0,i)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function s(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}class o{constructor(e){this._semaphore=new r(1,e)}acquire(){var e,t,n,i;return e=this,t=arguments,n=void 0,i=function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t},new(n||(n=Promise))(function(r,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}},59254:(e,t,n)=>{n.d(t,{j:()=>s});var i=Object.prototype.hasOwnProperty;function r(e,t,n){for(n of e.keys())if(s(n,t))return n}function s(e,t){var n,o,a;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&s(e[o],t[o]););return -1===o}if(n===Set){if(e.size!==t.size)return!1;for(o of e)if((a=o)&&"object"==typeof a&&!(a=r(t,a))||!t.has(a))return!1;return!0}if(n===Map){if(e.size!==t.size)return!1;for(o of e)if((a=o[0])&&"object"==typeof a&&!(a=r(t,a))||!s(o[1],t.get(a)))return!1;return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((o=e.byteLength)===t.byteLength)for(;o--&&e.getInt8(o)===t.getInt8(o););return -1===o}if(ArrayBuffer.isView(e)){if((o=e.byteLength)===t.byteLength)for(;o--&&e[o]===t[o];);return -1===o}if(!n||"object"==typeof e){for(n in o=0,e)if(i.call(e,n)&&++o&&!i.call(t,n)||!(n in t)||!s(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!=e&&t!=t}},63650:(e,t,n)=>{var i;n.d(t,{s:()=>i}),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(i||(i={}))},67255:(e,t,n)=>{let i;n.d(t,{A:()=>a});let r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},s=new Uint8Array(16),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));let a=function(e,t,n){if(r.randomUUID&&!t&&!e)return r.randomUUID();let a=(e=e||{}).random??e.rng?.()??function(){if(!i){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=crypto.getRandomValues.bind(crypto)}return i(s)}();if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=a[e];return t}return function(e,t=0){return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}(a)}},85001:(e,t,n)=>{n.d(t,{I:()=>d});var i=n(37591),r=n(38325),s=n(99706),o=n(63650),a=n(97858),l=n(16128),c=class{budgetConsumed;intervalHandle;options;constructor(e){this.options=e,this.budgetConsumed=0}getBackoffMs(){if(0===this.getBudgetConsumed())return 0;let e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*2**e,this.options.maxBackoffMs)+t}get totalBudgetRestoreTime(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}consumeBudget(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}getBudgetConsumed(){return this.budgetConsumed}hasBudget(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}startRestoringBudget(){if(this.intervalHandle)return;let e=()=>{let e=this.budgetConsumed;if(!e)return void this.stopLeak();let t=e-1;0!==t&&(this.budgetConsumed=t)};this.intervalHandle=setInterval(e,this.options.budgetRestoreIntervalMs)}stopLeak(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}close(){this.stopLeak()}},h=class extends i.oK{options;retryBudget;reconnectOnConnectionDrop=!0;handshakeExtensions;sessions;constructor(e,t){super(e,t),this.sessions=new Map,this.options={...r.I$,...t},this.retryBudget=new c(this.options)}extendHandshake(e){this.handshakeExtensions=e}tryReconnecting(e){let t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}send(e,t){if("closed"===this.getStatus()){let e="transport is closed, cant send";throw this.log?.error(e,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(e)}let n=this.sessions.get(e);return n||(n=this.createUnconnectedSession(e)),n.send(t)}createUnconnectedSession(e){let t=r.Dl.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}},this.options,this.log);return this.updateSession(t),t}onConnectingFailed(e){let t=super.onConnectingFailed(e);return this.tryReconnecting(t.to),t}onConnClosed(e){let t=super.onConnClosed(e);return this.tryReconnecting(t.to),t}onConnectionEstablished(e,t){let n=r.Dl.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:e=>{let t=(0,s.xH)(e);this.log?.error(`connection to ${n.to} errored during handshake: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.warn(`connection to ${n.to} closed during handshake`,n.loggingMetadata),this.onConnClosed(n)},onHandshake:e=>{this.onHandshakeResponse(n,e)},onInvalidHandshake:(t,r)=>{this.log?.error(`invalid handshake: ${t}`,n.loggingMetadata),this.deleteSession(e,{unhealthy:!0}),this.protocolError({type:i.bd.HandshakeFailed,code:r,message:t})},onHandshakeTimeout:()=>{this.log?.error(`connection to ${n.to} timed out during handshake`,n.loggingMetadata),this.onConnClosed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});return this.updateSession(n),this.sendHandshake(n),n}rejectHandshakeResponse(e,t,n){e.conn.telemetry?.span.setStatus({code:o.s.ERROR,message:t}),this.log?.warn(t,n),this.deleteSession(e,{unhealthy:!0})}onHandshakeResponse(e,t){if(!a.J(s.O9,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",{...e.loggingMetadata,transportMessage:t,validationErrors:[...l.I(s.O9,t.payload)]});if(!t.payload.status.ok){let n=a.J(s.Bi,t.payload.status.code),r=`handshake failed: ${t.payload.status.reason}`,o=e.to;this.rejectHandshakeResponse(e,r,{...e.loggingMetadata,transportMessage:t}),n?this.tryReconnecting(o):this.protocolError({type:i.bd.HandshakeFailed,code:t.payload.status.code,message:r});return}if(t.payload.status.sessionId!==e.id){let n=`session id mismatch: expected ${e.id}, got ${t.payload.status.sessionId}`;this.rejectHandshakeResponse(e,n,{...e.loggingMetadata,transportMessage:t});return}this.log?.info(`handshake from ${t.from} ok`,{...e.loggingMetadata,transportMessage:t});let n=r.Dl.transition.HandshakingToConnected(e,{onConnectionErrored:e=>{let t=(0,s.xH)(e);this.log?.warn(`connection to ${n.to} errored: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.info(`connection to ${n.to} closed`,n.loggingMetadata),this.onConnClosed(n)},onMessage:e=>this.handleMsg(e),onInvalidMessage:e=>{this.deleteSession(n,{unhealthy:!0}),this.protocolError({type:i.bd.InvalidMessage,message:e})}});this.updateSession(n),this.retryBudget.startRestoringBudget()}connect(e){if("open"!==this.getStatus())return void this.log?.info(`transport state is no longer open, cancelling attempt to connect to ${e}`);let t=this.sessions.get(e);if("NoConnection"!==(t??=this.createUnconnectedSession(e)).state)return void this.log?.debug(`session to ${e} has state ${t.state}, skipping connect attempt`,t.loggingMetadata);if(!this.retryBudget.hasBudget()){let n=this.retryBudget.getBudgetConsumed(),r=`tried to connect to ${e} but retry budget exceeded (more than ${n} attempts in the last ${this.retryBudget.totalBudgetRestoreTime}ms)`;this.log?.error(r,t.loggingMetadata),this.protocolError({type:i.bd.RetriesExceeded,message:r});return}let n=this.retryBudget.getBackoffMs();this.log?.info(`attempting connection to ${e} (${n}ms backoff)`,t.loggingMetadata),this.retryBudget.consumeBudget();let s=r.Dl.transition.NoConnectionToBackingOff(t,n,{onBackoffFinished:()=>{this.onBackoffFinished(s)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(s)}});this.updateSession(s)}onBackoffFinished(e){let t=s.VL.startActiveSpan("connect",async t=>{try{return await this.createNewOutgoingConnection(e.to)}catch(n){let e=(0,s.xH)(n);throw t.recordException(e),t.setStatus({code:o.s.ERROR}),n}finally{t.end()}}),n=r.Dl.transition.BackingOffToConnecting(e,t,{onConnectionEstablished:e=>{this.log?.debug(`connection to ${n.to} established`,{...e.loggingMetadata,...n.loggingMetadata}),this.onConnectionEstablished(n,e)},onConnectionFailed:e=>{let t=(0,s.xH)(e);this.log?.error(`error connecting to ${n.to}: ${t}`,n.loggingMetadata),this.onConnectingFailed(n)},onConnectionTimeout:()=>{this.log?.error(`connection to ${n.to} timed out`,n.loggingMetadata),this.onConnectingFailed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});this.updateSession(n)}async sendHandshake(e){let t;if(this.handshakeExtensions&&(t=await this.handshakeExtensions.construct()),e._isConsumed)return;let n=(0,s.sE)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:t,tracing:(0,s.oG)(e.telemetry.ctx)});this.log?.debug(`sending handshake request to ${e.to}`,{...e.loggingMetadata,transportMessage:n}),e.sendHandshake(n)}close(){this.retryBudget.close(),super.close()}},u=class extends i.Ng{ws;extras;get loggingMetadata(){let e=super.loggingMetadata;return this.extras&&(e.extras=this.extras),e}constructor(e,t){super(),this.ws=e,this.extras=t,this.ws.binaryType="arraybuffer";let n=!1;this.ws.onerror=()=>{n=!0},this.ws.onclose=({code:e,reason:t})=>{if(n){let n=Error(`websocket closed with code and reason: ${e} - ${t}`);for(let e of this.errorListeners)e(n)}for(let e of this.closeListeners)e()},this.ws.onmessage=e=>{for(let t of this.dataListeners)t(e.data)}}send(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}close(){this.ws.close(1e3)}},d=class extends h{wsGetter;constructor(e,t,n){super(t,n),this.wsGetter=e}async createNewOutgoingConnection(e){this.log?.info(`establishing a new websocket to ${e}`,{clientId:this.clientId,connectedTo:e});let t=await this.wsGetter(e);await new Promise((e,n)=>t.readyState===t.OPEN?void e():t.readyState===t.CLOSING||t.readyState===t.CLOSED?void n(Error("ws is closing or closed")):void(t.onopen=()=>{e()},t.onclose=e=>{n(Error(e.reason))},t.onerror=e=>{n(Error(e.message))}));let n=new u(t);return this.log?.info(`raw websocket to ${e} ok`,{clientId:this.clientId,connectedTo:e,...n.loggingMetadata}),n}}},90067:(e,t,n)=>{n.d(t,{a6:()=>m,vt:()=>G});var i=n(95570);let r={Remove:"remove",Replace:"replace",Add:"add"},s=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),o=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),a=Symbol.iterator,l={mutable:"mutable",immutable:"immutable"},c={};function h(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){if(t in e){let n=Reflect.getPrototypeOf(e);for(;n;){let e=Reflect.getOwnPropertyDescriptor(n,t);if(e)return e;n=Reflect.getPrototypeOf(n)}}}function d(e){return Object.getPrototypeOf(e)===Set.prototype}function f(e){return Object.getPrototypeOf(e)===Map.prototype}function p(e){var t;return null!=(t=e.copy)?t:e.original}function g(e){return"object"!=typeof e?null:null==e?void 0:e[s]}function y(e){var t;let n=g(e);return n?null!=(t=n.copy)?t:n.original:e}function m(e,t){let n;return!!e&&"object"==typeof e&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!(null==t?void 0:t.mark)&&((n=t.mark(e,l))===l.immutable||"function"==typeof n))}function v(e){return Array.isArray(e)?1:e instanceof Map?2:3*(e instanceof Set)}function w(e,t){return 2===v(e)?e.get(t):e[t]}function b(e,t,n){2===v(e)?e.set(t,n):e[t]=n}function E(e,t){let n=g(e);return(n?p(n):e)[t]}function x(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function k(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function S(e,t){return t?e:[""].concat(e).map(e=>{let t=`${e}`;return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}let M=Object.prototype.propertyIsEnumerable;function C(e,t){let n;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set)return d(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if(e instanceof Map)return f(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,l))&&n!==l.mutable){if(n===l.immutable){let t=Object.create(Object.getPrototypeOf(e));return Reflect.ownKeys(e).forEach(n=>{let i=Reflect.getOwnPropertyDescriptor(e,n);if(i.enumerable&&i.configurable&&i.writable){t[n]=e[n];return}i.writable||(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(i={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[n]}),Reflect.defineProperty(t,n,i)}),t}if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error(`Unsupported mark result: ${n}`)}if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype){let t={};return Object.keys(e).forEach(n=>{t[n]=e[n]}),Object.getOwnPropertySymbols(e).forEach(n=>{M.call(e,n)&&(t[n]=e[n])}),t}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function _(e){e.copy||(e.copy=C(e.original,e.options))}function U(e){return g(e)?function e(t){if(!m(t))return y(t);if(Array.isArray(t))return t.map(e);if(t instanceof Map){let n=Array.from(t.entries()).map(([t,n])=>[t,e(n)]);return f(t)?new Map(n):new(Object.getPrototypeOf(t)).constructor(n)}if(t instanceof Set){let n=Array.from(t).map(e);return d(t)?new Set(n):new(Object.getPrototypeOf(t)).constructor(n)}let n=Object.create(Object.getPrototypeOf(t));for(let i in t)n[i]=e(t[i]);return n}(e):e}function T(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&T(e.parent))}function I(){throw Error("Cannot modify frozen object")}function B(e,t){let n=v(e);if(0===n)Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)});else if(1===n){let n=0;for(let i of e)t(n,i,e),n+=1}else e.forEach((n,i)=>t(i,n,e))}function O(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(t=>{e.copy.add(y(t))}))}function L(e,t,n,i){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&i){let r=function e(t,n=[]){if(Object.hasOwnProperty.call(t,"key")){let e=t.parent.copy,i=g(w(e,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;let r=3===t.parent.type,s=r?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(r&&e.size>s||h(e,s)))return null;n.push(s)}if(t.parent)return e(t.parent,n);n.reverse();try{var i=t.copy,r=n;for(let e=0;e<r.length-1;e+=1){let t=r[e];if("object"!=typeof(i=w(3===v(i)?Array.from(i):i,t)))throw Error(`Cannot resolve patch at '${r.join("/")}'.`)}}catch(e){return null}return n}(e);r&&t(e,r,n,i)}e.finalized=!0}}function P(e,t,n,i){let r=g(n);r&&(r.callbacks||(r.callbacks=[]),r.callbacks.push((s,o)=>{var a;let l=3===e.type?e.setMap:e.copy;if(x(w(l,t),n)){let n=r.original;r.copy&&(n=r.copy),O(e),L(e,i,s,o),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(a=e.options.updatedValues)?a:new WeakMap,e.options.updatedValues.set(n,r.original)),b(l,t,n)}}),e.options.enableAutoFreeze&&r.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),m(n,e.options)&&e.finalities.draft.push(()=>{x(w(3===e.type?e.setMap:e.copy,t),n)&&function(e,t){let n=3===e.type?e.setMap:e.copy;e.finalities.revoke.length>1&&e.assignedMap.get(t)&&n&&function e(t,n,i){if(g(t)||!m(t,i)||n.has(t)||Object.isFrozen(t))return;let r=t instanceof Set,s=r?new Map:void 0;if(n.add(t),B(t,(o,a)=>{var l;if(g(a)){let e=g(a);_(e),b(r?s:t,o,(null==(l=e.assignedMap)?void 0:l.size)||e.operated?e.copy:e.original)}else e(a,n,i)}),s){let e=Array.from(t);t.clear(),e.forEach(e=>{t.add(s.has(e)?s.get(e):e)})}}(w(n,t),e.finalities.handledSet,e.options)}(e,t)})}function A(e,t,n,i){let{pathAsArray:s=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return function({original:e,copy:t,assignedMap:n},i,s,o,a){n.forEach((n,l)=>{let c=w(e,l),u=U(w(t,l)),d=n?h(e,l)?r.Replace:r.Add:r.Remove;if(x(c,u)&&d===r.Replace)return;let f=S(i.concat(l),a);s.push(d===r.Remove?{op:d,path:f}:{op:d,path:f,value:u}),o.push(d===r.Add?{op:r.Remove,path:f}:d===r.Remove?{op:r.Add,path:f,value:c}:{op:r.Replace,path:f,value:c})})}(e,t,n,i,s);case 1:return function(e,t,n,i,s){let{original:o,assignedMap:a,options:l}=e,c=e.copy;c.length<o.length&&([o,c]=[c,o],[n,i]=[i,n]);for(let e=0;e<o.length;e+=1)if(a.get(e.toString())&&c[e]!==o[e]){let a=S(t.concat([e]),s);n.push({op:r.Replace,path:a,value:U(c[e])}),i.push({op:r.Replace,path:a,value:U(o[e])})}for(let e=o.length;e<c.length;e+=1){let i=S(t.concat([e]),s);n.push({op:r.Add,path:i,value:U(c[e])})}if(o.length<c.length){let{arrayLengthAssignment:e=!0}=l.enablePatches;if(e){let e=S(t.concat(["length"]),s);i.push({op:r.Replace,path:e,value:o.length})}else for(let e=c.length;o.length<e;e-=1){let n=S(t.concat([e-1]),s);i.push({op:r.Remove,path:n})}}}(e,t,n,i,s);case 3:return function({original:e,copy:t},n,i,s,o){let a=0;e.forEach(e=>{if(!t.has(e)){let t=S(n.concat([a]),o);i.push({op:r.Remove,path:t,value:e}),s.unshift({op:r.Add,path:t,value:e})}a+=1}),a=0,t.forEach(t=>{if(!e.has(t)){let e=S(n.concat([a]),o);i.push({op:r.Add,path:e,value:t}),s.unshift({op:r.Remove,path:e,value:t})}a+=1})}(e,t,n,i,s)}}let D=(e,t,n=!1)=>{if("object"==typeof e&&null!==e&&(!m(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},R={get size(){return p(g(this)).size},has(e){return p(g(this)).has(e)},set(e,t){let n=g(this),i=p(n);return i.has(e)&&x(i.get(e),t)||(_(n),T(n),n.assignedMap.set(e,!0),n.copy.set(e,t),P(n,e,t,A)),this},delete(e){if(!this.has(e))return!1;let t=g(this);return _(t),T(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){let e=g(this);if(this.size){for(let[t]of(_(e),T(e),e.assignedMap=new Map,e.original))e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){p(g(this)).forEach((n,i)=>{e.call(t,this.get(i),i,this)})},get(e){var t,n;let i=g(this),r=p(i).get(e),s=(null==(n=(t=i.options).mark)?void 0:n.call(t,r,l))===l.mutable;if(i.options.strict&&D(r,i.options,s),s||i.finalized||!m(r,i.options)||r!==i.original.get(e))return r;let o=c.createDraft({original:r,parentDraft:i,key:e,finalities:i.finalities,options:i.options});return _(i),i.copy.set(e,o),o},keys(){return p(g(this)).keys()},values(){let e=this.keys();return{[a]:()=>this.values(),next:()=>{let t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){let e=this.keys();return{[a]:()=>this.entries(),next:()=>{let t=e.next();if(t.done)return t;let n=this.get(t.value);return{done:!1,value:[t.value,n]}}}},[a](){return this.entries()}},$=Reflect.ownKeys(R),j=(e,t,{isValuesIterator:n})=>()=>{var i,r;let s=t.next();if(s.done)return s;let o=s.value,a=e.setMap.get(o),h=g(a),u=(null==(r=(i=e.options).mark)?void 0:r.call(i,a,l))===l.mutable;if(e.options.strict&&D(o,e.options,u),!u&&!h&&m(o,e.options)&&!e.finalized&&e.original.has(o)){let t=c.createDraft({original:o,parentDraft:e,key:o,finalities:e.finalities,options:e.options});e.setMap.set(o,t),a=t}else h&&(a=h.proxy);return{done:!1,value:n?a:[a,a]}},H={get size(){return g(this).setMap.size},has(e){let t=g(this);if(t.setMap.has(e))return!0;_(t);let n=g(e);return!!(n&&t.setMap.has(n.original))},add(e){let t=g(this);return this.has(e)||(_(t),T(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),P(t,e,e,A)),this},delete(e){if(!this.has(e))return!1;let t=g(this);_(t),T(t);let n=g(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;let e=g(this);for(let t of(_(e),T(e),e.original))e.assignedMap.set(t,!1);e.setMap.clear()},values(){let e=g(this);_(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:j(e,t,{isValuesIterator:!0})}},entries(){let e=g(this);_(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:j(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[a](){return this.values()},forEach(e,t){let n=this.values(),i=n.next();for(;!i.done;)e.call(t,i.value,i.value,this),i=n.next()}};Set.prototype.difference&&Object.assign(H,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});let N=Reflect.ownKeys(H),F=new WeakSet,z={get(e,t,n){var i,r;let o,a=null==(i=e.copy)?void 0:i[t];if(a&&F.has(a))return a;if(t===s)return e;if(e.options.mark){let i="size"===t&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((o=e.options.mark(i,l))===l.mutable)return e.options.strict&&D(i,e.options,!0),i}let c=p(e);if(c instanceof Map&&$.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(R,"size").get.call(e.proxy);let n=R[t];if(n)return n.bind(e.proxy)}if(c instanceof Set&&N.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(H,"size").get.call(e.proxy);let n=H[t];if(n)return n.bind(e.proxy)}if(!h(c,t)){let n=u(c,t);return n?"value"in n?n.value:null==(r=n.get)?void 0:r.call(e.proxy):void 0}let d=c[t];if(e.options.strict&&D(d,e.options),e.finalized||!m(d,e.options))return d;if(d===E(e.original,t)){if(_(e),e.copy[t]=q({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof o){let n=g(e.copy[t]);return _(n),T(n),n.copy}return e.copy[t]}return d},set(e,t,n){var i;let r;if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(r=Number(t))&&r>=0&&(0===t||0===r||String(r)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");let s=u(p(e),t);if(null==s?void 0:s.set)return s.set.call(e.proxy,n),!0;let o=E(p(e),t),a=g(o);return a&&x(a.original,n)?(e.copy[t]=n,e.assignedMap=null!=(i=e.assignedMap)?i:new Map,e.assignedMap.set(t,!1),!0):!!(x(n,o)&&(void 0!==n||h(e.original,t)))||(_(e),T(e),h(e.original,t)&&x(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,P(e,t,n,A),!0)},has:(e,t)=>t in p(e),ownKeys:e=>Reflect.ownKeys(p(e)),getOwnPropertyDescriptor(e,t){let n=p(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var n;return 1===e.type?z.set.call(this,e,t,void 0,e.proxy):(void 0!==E(e.original,t)||t in e.original?(_(e),T(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function q(e){let{original:t,parentDraft:n,key:i,finalities:r,options:s}=e,o=v(t),a={type:o,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:r,options:s,setMap:3===o?new Map(t.entries()):void 0};(i||"key"in e)&&(a.key=i);let{proxy:l,revoke:c}=Proxy.revocable(1===o?Object.assign([],a):a,z);if(r.revoke.push(c),F.add(l),a.proxy=l,n)n.finalities.draft.push((e,t)=>{var r,s;let o=g(l),a=3===n.type?n.setMap:n.copy,c=w(a,i),h=g(c);if(h){let s=h.original;h.operated&&(s=y(c)),O(h),L(h,A,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(r=n.options.updatedValues)?r:new WeakMap,n.options.updatedValues.set(s,h.original)),b(a,i,s)}null==(s=o.callbacks)||s.forEach(n=>{n(e,t)})});else{let e=g(l);e.finalities.draft.push((t,n)=>{O(e),L(e,A,t,n)})}return l}function W(e){let{rootDraft:t,value:n,useRawReturn:r=!1,isRoot:s=!0}=e;B(n,(n,i,r)=>{let s=g(i);if(s&&t&&s.finalities===t.finalities){e.isContainDraft=!0;let t=s.original;if(r instanceof Set){let e=Array.from(r);r.clear(),e.forEach(e=>r.add(n===e?t:e))}else b(r,n,t)}else"object"==typeof i&&null!==i&&(e.value=i,e.isRoot=!1,W(e))}),s&&(e.isContainDraft||i.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&i.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function V(e){if(!g(e))throw Error(`current() is only used for Draft, parameter: ${e}`);return function e(t){var n;let i,r=g(t);if(!m(t,null==r?void 0:r.options))return t;let s=v(t);if(r&&!r.operated)return r.original;function o(){i=2===s?f(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===s?Array.from(r.setMap.values()):C(t,null==r?void 0:r.options)}if(r){r.finalized=!0;try{o()}finally{r.finalized=!1}}else i=t;if(B(i,(n,s)=>{if(r&&x(w(r.original,n),s))return;let a=e(s);a!==s&&(i===t&&o(),b(i,n,a))}),3===s){let e=null!=(n=null==r?void 0:r.original)?n:i;return d(e)?new Set(i):new(Object.getPrototypeOf(e)).constructor(i)}return i}(e)}c.createDraft=q;let G=(e=>{if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error(`Invalid options: ${String(e)}, 'options' should be an object.`);return function t(n,i,s){var a,c,h;let u;if("function"==typeof n&&"function"!=typeof i)return function(e,...r){return t(e,e=>n.call(this,e,...r),i)};let d=s;if("function"!=typeof i&&(d=i),void 0!==d&&"[object Object]"!==Object.prototype.toString.call(d))throw Error(`Invalid options: ${d}, 'options' should be an object.`);d=Object.assign(Object.assign({},e),d);let f=g(n)?V(n):n,p=Array.isArray(d.mark)?(e,t)=>{for(let n of d.mark){if("function"!=typeof n)throw Error(`Invalid mark: ${n}, 'mark' should be a function.`);let i=n(e,t);if(i)return i}}:d.mark,y=null!=(a=d.enablePatches)&&a,w=null!=(c=d.strict)&&c,b={enableAutoFreeze:null!=(h=d.enableAutoFreeze)&&h,mark:p,strict:w,enablePatches:y};if(!m(f,b)&&"object"==typeof f&&null!==f)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");let[E,S]=function(e,t){var n;let i,s,o={draft:[],revoke:[],handledSet:new WeakSet};t.enablePatches&&(i=[],s=[]);let a=(null==(n=t.mark)?void 0:n.call(t,e,l))!==l.mutable&&m(e,t)?q({original:e,parentDraft:null,finalities:o,options:t}):e;return[a,(e=[])=>{let[n,o,l]=function(e,t,n,i,s){var o;let a=g(e),l=null!=(o=null==a?void 0:a.original)?o:e,c=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,i);let h=c?t[0]:a?a.operated?a.copy:a.original:e;return a&&k(a),s&&function e(t,n,i,r,s){{i=null!=i?i:new WeakMap,r=null!=r?r:[],s=null!=s?s:[];let e=i.has(t)?i.get(t):t;if(r.length>0){let t=r.indexOf(e);if(e&&"object"==typeof e&&-1!==t){if(r[0]===e)throw Error("Forbids circular reference");throw Error(`Forbids circular reference: ~/${s.slice(0,t).map((e,t)=>{if("symbol"==typeof e)return`[${e.toString()}]`;let n=r[t];return"object"==typeof e&&(n instanceof Map||n instanceof Set)?Array.from(n.keys()).indexOf(e):e}).join("/")}`)}r.push(e),s.push(n)}else r.push(e)}if(Object.isFrozen(t)||g(t)){r.pop(),s.pop();return}switch(v(t)){case 2:for(let[n,o]of t)e(n,n,i,r,s),e(o,n,i,r,s);t.set=t.clear=t.delete=I;break;case 3:for(let n of t)e(n,n,i,r,s);t.add=t.clear=t.delete=I;break;case 1:Object.freeze(t);let o=0;for(let n of t)e(n,o,i,r,s),o+=1;break;default:Object.freeze(t),Object.keys(t).forEach(n=>{e(t[n],n,i,r,s)})}r.pop(),s.pop()}(h,h,null==a?void 0:a.options.updatedValues),[h,n&&c?[{op:r.Replace,path:[],value:t[0]}]:n,i&&c?[{op:r.Replace,path:[],value:l}]:i]}(a,e,i,s,t.enableAutoFreeze);return t.enablePatches?[n,o,l]:n}]}(f,b);if("function"!=typeof i){if(!m(f,b))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,S]}try{u=i(E)}catch(e){throw k(g(E)),e}let M=e=>{let t=g(E);if(!g(e)){if(void 0!==e&&!x(e,E)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");let n=null==e?void 0:e[o];if(n){let i=n[0];return b.strict&&"object"==typeof e&&null!==e&&W({rootDraft:t,value:e,useRawReturn:!0}),S([i])}if(void 0!==e)return"object"==typeof e&&null!==e&&W({rootDraft:t,value:e}),S([e])}if(e===E||void 0===e)return S([]);let n=g(e);if(b===n.options){if(n.operated)throw Error("Cannot return a modified child draft.");return S([V(e)])}return S([e])};return u instanceof Promise?u.then(M,e=>{throw k(g(E)),e}):M(u)}})();Object.prototype.constructor.toString()}}]);
//# sourceMappingURL=649-83bc17c922ee7081.js.map
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="39695c8e-c530-4312-9730-3a62520cd65a",e._sentryDebugIdIdentifier="sentry-dbid-39695c8e-c530-4312-9730-3a62520cd65a")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"ef5ff8f4"};"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7276],{36163:(e,r,t)=>{t.d(r,{Dl:()=>o,ob:()=>i});var n=t(1196),o=(0,n.mc)("."),i=(0,n.mc)(".env");(0,n.mc)(".lesson"),(0,n.mc)(".tutorial")},36316:(e,r,t)=>{t.d(r,{RZ:()=>i,TJ:()=>s,_L:()=>a});var n=t(12111),o=/^(\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner|\.local)/;function i(e){return o.test(e)}function a(e){return e.startsWith(".")&&!n.Ay.includes(e)}var s=[".git",".upm",".cache","__pycache__","node_modules","venv",".pythonlibs",".local"]},67276:(e,r,t)=>{t.d(r,{r2:()=>Q,Ay:()=>U,KF:()=>z});var n=t(29935),o=t(17844),i=t(93629),a=t(56902),s=t(86105),l=t(82643),c=t(90629),u=t(80478),f=t(74651),d=t(97858),h=t(52535),p=t(9686),v=t(49069),m=t(89943),y=t(73920),g=t(16732),C=t(5278),w=t(98565),E=t(1196),b=t(59270),T=t(82167),_=t(36316),S=t(36163),D=t(62019),k=t(37743),F=t(1833),x=t(62178),R=t(96907),O=t.n(R),I=t(66474),N=t(62325),A=t(30284),V=t(2916),P=t(96367),M=t(49999),Y=t(49555);function L(e,r){var t=!0,n=!1,o=void 0;try{for(var i,a=r[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;switch(s){case Y.Tr.NotFound:if(e.includes("no such file")||e.includes("file does not exist"))return Y.Tr.NotFound;break;case Y.Tr.AlreadyExists:if(e.includes("file exist"))return Y.Tr.AlreadyExists;break;case Y.Tr.NotDirectory:if(e.includes("not a directory"))return Y.Tr.NotDirectory;break;case Y.Tr.IsDirectory:if(e.includes("is a directory"))return Y.Tr.IsDirectory;break;case Y.Tr.InvalidPath:if(e.includes("absolute paths are not supported"))return Y.Tr.InvalidPath;break;case Y.Tr.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return Y.Tr.DiskQuotaExceeded;break;case Y.Tr.PermissionDenied:if(e.includes("permission denied"))return Y.Tr.PermissionDenied;break;case Y.Tr.FileSystemUnavailable:if(e.includes("input/output error"))return Y.Tr.FileSystemUnavailable;break;case Y.Tr.NotReadable:if(e.includes("could not read the uploaded file"))return Y.Tr.NotReadable;break;default:(0,M.A)(s)}}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}return null}var H=function(e){"use strict";function r(e,t,a,s,c,u){(0,k._)(this,r),(f=(0,D._)(this,r)).writeChanges=function(e,r){if(!f.channel&&!f.isReconnecting)throw Error("Trying to send changes before ever coming online");f.isReconnecting&&(f.didEditOffline=!0);var t=(0,P.$1)(e,f.localContent),n=t.op,i=t.docAfter;if(.1>Math.random()){var a=(0,P.nq)(I.type.apply(f.localContent,n)),s=e.apply((0,P.G0)(f.localContent));(a!==s.sliceString(0)||a!==(0,P.nq)(i))&&f.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:a,changeSetContent:s,docAfter:i})}var l=(null==r?void 0:r.author)==="ghostwriter"?{author:y.api.OTPacket.Author.GHOSTWRITER}:{};f.metadata=(0,o._)({},f.metadata,l);try{f.pending=I.type.compose(f.pending,n)}catch(e){throw V.A.wrap(e).setExtras({op:n,pending:f.pending})}f.localContent=i,0!==f.pending.length?f.emit("fileDirty"):f.commitPromise&&f.emit("commitStart"),f.debounceSend()},f.updateCursors=function(e){f.pendingCursors=e,f.debounceSend()},f.isClean=function(){return f.committedVersion===f.version&&0===f.inflight.length&&0===f.pending.length},f.onError=function(e,r){if(r.originalError){var t="string"==typeof r.originalError?r.originalError:r.originalError.message,n=L(t,[Y.Tr.NotFound,Y.Tr.IsDirectory,Y.Tr.DiskQuotaExceeded,Y.Tr.InvalidPath,Y.Tr.PermissionDenied,Y.Tr.FileSystemUnavailable]);if(n)return void f.emit("fsError",n,t)}f.destroy();var a=Error("OT Error: "+e);f.emit("error",a,(0,i._)((0,o._)({},r),{filePath:f.linkedFile,version:f.version}))},f.sendOp=function(){if(f.channel&&"open"===f.channel.status&&!f.isReconnecting&&!(f.inflight.length>0)){if(0!==f.pending.length){var e=(0,P.RV)(f.pending);f.inflight=f.pending,f.pending=[],f.inflightOpsPromise=f.channel.request({ot:(0,o._)({spookyVersion:f.version,op:e},f.metadata)}),f.metadata={},f.inflightOpsPromise.then(function(r){r.error&&f.onError("error accepting packet",{originalError:r.error,op:e})})}if(0!==f.pendingCursors.length){var r=!0,t=!1,n=void 0;try{for(var i,a=f.flushedCursorIds[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;f.channel.send({otDeleteCursor:{id:s}})}}catch(e){t=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw n}}f.flushedCursorIds=[];var l=!0,c=!1,u=void 0;try{for(var d,h=f.pendingCursors[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var p=d.value,v=Number(Math.random().toString().split(".")[1]).toString(36);f.flushedCursorIds.push(v),f.channel.send({otNewCursor:(0,o._)({id:v,user:f.user},p)})}}catch(e){c=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw u}}f.pendingCursors=[]}}},f.handlePacket=function(e,r){var t,n,o,i=e.op,a=e.version,s=e.crc32,l=e.userId,c=r.overrideReconnectingBuffer;if(f.isReconnecting&&!c)return void f.bufferedReconnectingOps.push({crc32:s,op:i,version:a,userId:l});if(-1===f.version)return void f.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});if(f.version++,a!==f.version){var u={originalError:null,expectedVersion:f.version,receivedVersion:a,incomingOp:i};f.logger.error("OT Error: invalid server version",(0,N.dA)({details:u})),f.onError("invalid server version",u);return}try{f.serverContent=I.type.apply(f.serverContent,i)}catch(e){f.onError("unable to apply updated content",{originalError:e,incomingOp:i});return}var d=h.str(f.serverContent)>>>0;if(d!==s){var p={originalError:null,incomingVersion:a,server:s,client:d,incomingOp:i};f.logger.error("OT Error: crc32 mismatch",(0,N.dA)({details:p})),f.onError("crc32 mismatch",p);return}if(f.uncommittedOps.push({version:a,crc32:s,op:i,userId:l}),f.dataloss&&f.shouldTrackDataLoss&&f.dataloss.storeOp({replId:f.replId,filePath:f.linkedFile.toString(),opType:"latestOp",op:{version:a,crc32:s},logger:f.logger,isReconnecting:f.isReconnecting}),JSON.stringify(i)===JSON.stringify(f.inflight)){f.dataloss&&f.shouldTrackDataLoss&&f.dataloss.storeOp({replId:f.replId,filePath:f.linkedFile.toString(),opType:"latestOwnOp",op:{version:a,crc32:s},logger:f.logger,isReconnecting:f.isReconnecting}),f.debounceCommit(),f.inflight=[],f.inflightOpsPromise=null,f.debounceSend(),f.debounceSend.flush();return}if(f.commitPromise||f.emit("fileDirty"),f.debounceCommit(),f.hasUncommittedMultiplayerOps=!0,f.inflight.length){var v=I.type.transform(f.inflight,i,"right");i=I.type.transform(i,f.inflight,"left"),f.inflight=v}if(f.pending.length){var m=I.type.transform(f.pending,i,"right");i=I.type.transform(i,f.pending,"left"),f.pending=m}try{t=(o=(0,P.nD)(i,f.localContent)).changes,n=o.docAfter}catch(e){f.onError("unable to apply updated op",{originalError:e,incomingOp:i});return}if(.1>Math.random()){var y=(0,P.nq)(I.type.apply(f.localContent,i)),g=t.apply((0,P.G0)(f.localContent));(y!==g.sliceString(0)||y!==(0,P.nq)(n))&&f.onError("op to changeset mismatch",{originalError:null,op:i,otContent:y,changeSetContent:g,docAfter:n})}f.localContent=n,f.emit("changes",t,l)},f.handleNewCursor=function(e){f.emit("cursor",e)},f.handleDeleteCursor=function(e){var r=e.id;f.emit("removeCursor",r)},f.handleStatus=function(e){return(0,n._)(function(){var r,t,n,o,i;return(0,l.YH)(this,function(a){switch(a.label){case 0:if(!f.channel||"open"!==f.channel.status)return[2];if(e.linkedFile){if(null==e.contents)return f.onError("expected status contents, got null or undefined",{originalError:null}),[2];if(null==e.cursors)return f.onError("expected status cursors, got null or undefined",{originalError:null}),[2];if(null==e.version)return f.onError("expected status version, got null or undefined",{originalError:null}),[2];if(f.isReconnecting)return f.handleReconnect(e.contents,e.version),[2];return f.dataloss&&f.shouldTrackDataLoss&&f.dataloss.checkAndTrack({serverContent:e.contents,serverVersion:e.version,replId:f.replId,filePath:f.linkedFile.toString(),fetchOps:f.fetchOps,logger:f.logger}),f.serverContent=e.contents,f.localContent=f.serverContent,f.version=e.version,f.emit("firstConnect"),f.emit("changes",v.VR.of({from:0,insert:f.serverContent},0)),e.cursors.forEach(f.handleNewCursor),f.emit("fileDirty"),f.debounceCommit(),[2]}return[4,f.channel.request({otLinkFile:{file:{path:f.linkedFile.toString()}}})];case 1:if((t=a.sent()).channelClosed)return[2];if(t.error)return f.onError("link file error "+t.error.replace(f.linkedFile.toString(),"$FILENAME"),{originalError:t.error}),[2];if(!t.otLinkFileResponse)return f.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null}),[2];if(n=t.otLinkFileResponse.version,i=w.A.from(null!=(o=null==(r=t.otLinkFileResponse.linkedFile)?void 0:r.content)?o:"").toString(),f.isReconnecting)return f.handleReconnect(i,n),[2];return f.dataloss&&f.shouldTrackDataLoss&&f.dataloss.checkAndTrack({serverContent:i,serverVersion:n,replId:f.replId,filePath:f.linkedFile.toString(),fetchOps:f.fetchOps,logger:f.logger}),f.serverContent=i,f.localContent=f.serverContent,f.version=n,f.committedVersion=n,f.committedContent=f.serverContent,f.emit("firstConnect"),f.emit("changes",v.VR.of({from:0,insert:f.serverContent},0)),[2]}})})()},f.handleReconnect=function(e,r){return(0,n._)(function(){var t,n,a,s,c,u,d,h,p,v,m,y,g,C,w,E,b,T,_,S,D,k,F,x,R,O,V,P,M,Y,L,H,q,U,B,z,Q,$,J,W,Z,j,G,K,X,ee,er,et,en,eo,ei;return(0,l.YH)(this,function(l){switch(l.label){case 0:if(!f.timeDisconnected)throw Error("wat");if(t=Date.now()-f.timeDisconnected,n={case:"other",remoteContent:e,localContent:f.localContent},a=function(n){f.reconnectTrackedData=(0,i._)((0,o._)({},n),{serverVersion:r,ourVersion:f.version,ourCommittedVersion:f.committedVersion,areContentsEqual:f.serverContent===e,areCommittedContentsEqual:f.committedContent===e,didReceiveOpsWhileReconnecting:!!f.bufferedReconnectingOps.length,didEditOffline:f.didEditOffline,hasPendingOps:!!f.pending.length,hasUncommittedMultiplayerOps:f.hasUncommittedMultiplayerOps,disconnectDuration:t});var a={};("has_inflight"===n.case||"same_version_different_content"===n.case||"multiplayer"===n.case)&&.1>Math.random()&&(a={hasAdditionalLogs:!0,localContent:String(f.localContent),ourContent:String(f.serverContent),ourCommittedContent:String(f.committedContent),ourInflight:JSON.stringify(f.inflight),ourPending:JSON.stringify(f.pending),serverContent:String(e)}),f.logger.info("OT Client: Reconnect",(0,N.dA)((0,o._)({},f.reconnectTrackedData,a))),f.track&&f.track(A.AZ.FILE_RECONNECTED_STATUS2,f.reconnectTrackedData)},s=function(e,r){a({case:e,originCase:r,prompted:!1}),f.isReconnecting=!1,f.bufferedReconnectingOps=[],f.didEditOffline=!1,f.timeDisconnected=null,f.debounceSend(),f.debounceCommit(),f.emit("transparentReconnect",{case:e,originCase:r})},c=function(t){if(n.remoteContent===n.localContent){f.version=r,f.committedVersion=r,f.localContent=e,f.committedContent=e,f.serverContent=e,f.inflight=[],f.pending=[],s("unprompted_because_identical",t);return}a({case:t,prompted:!0}),n.case=t,f.emit("promptUserReconnect",n)},f.inflight.length){if(r===f.version&&f.serverContent===e)return f.pending=I.type.compose(f.inflight,f.pending),f.inflight=[],f.inflightOpsPromise=null,s("has_inflight_happy_path_ops_unreached"),[2];u=!1,d=f.serverContent;try{d=I.type.apply(d,f.inflight)}catch(e){u=!0}if(!u&&f.version+1===r&&d===e)return f.inflight=[],f.inflightOpsPromise=null,f.serverContent=e,f.version=r,s("has_inflight_happy_path_ops_reached"),[2];return c("has_inflight"),[2]}if(f.hasUncommittedMultiplayerOps)return c("multiplayer"),[2];if(f.version===r){if(e===f.serverContent)return s("happy_path"),[2];return c("same_version_different_content"),[2]}if(f.committedVersion===r){h=e;try{p=!0,v=!1,m=void 0;try{for(y=f.uncommittedOps[Symbol.iterator]();!(p=(g=y.next()).done);p=!0)C=g.value.op,h=I.type.apply(h,C)}catch(e){v=!0,m=e}finally{try{p||null==y.return||y.return()}finally{if(v)throw m}}}catch(e){return c("same_committed_version_unable_to_apply_ops"),[2]}if(h===f.serverContent){w=[],E=!0,b=!1,T=void 0;try{for(_=f.uncommittedOps[Symbol.iterator]();!(E=(S=_.next()).done);E=!0)D=S.value.op,w=I.type.compose(w,D)}catch(e){b=!0,T=e}finally{try{E||null==_.return||_.return()}finally{if(b)throw T}}return f.pending=I.type.compose(w,f.pending),f.uncommittedOps=[],f.version=r,f.serverContent=e,s("happy_path_uncommitted"),[2]}return c("same_committed_version_different_content_fixed"),[2]}if(!(f.version<r))return[3,3];return[4,f.fetchOps(f.version+1,r)];case 1:k=l.sent(),F=!1,x=f.serverContent;try{R=!0,O=!1,V=void 0;try{for(P=k[Symbol.iterator]();!(R=(M=P.next()).done);R=!0)Y=M.value.op,x=I.type.apply(x,Y)}catch(e){O=!0,V=e}finally{try{R||null==P.return||P.return()}finally{if(O)throw V}}}catch(e){F=!0}if(!F&&x===e){L=!0,H=!1,q=void 0;try{for(U=k[Symbol.iterator]();!(L=(B=U.next()).done);L=!0)z=B.value,f.handlePacket(z,{overrideReconnectingBuffer:!0})}catch(e){H=!0,q=e}finally{try{L||null==U.return||U.return()}finally{if(H)throw q}}Q=!0,$=!1,J=void 0;try{for(W=f.bufferedReconnectingOps[Symbol.iterator]();!(Q=(Z=W.next()).done);Q=!0)j=Z.value,f.handlePacket(j,{overrideReconnectingBuffer:!0})}catch(e){$=!0,J=e}finally{try{Q||null==W.return||W.return()}finally{if($)throw J}}return s("happy_path_server_ahead"),[2]}return[4,f.fetchOps(f.committedVersion+1,r)];case 2:G=l.sent(),K=!1,X=f.committedContent;try{ee=!0,er=!1,et=void 0;try{for(en=G[Symbol.iterator]();!(ee=(eo=en.next()).done);ee=!0)ei=eo.value.op,X=I.type.apply(X,ei)}catch(e){er=!0,et=e}finally{try{ee||null==en.return||en.return()}finally{if(er)throw et}}}catch(e){K=!0}if(!K&&X===e)return c("happy_path_uncommitted_server_ahead"),[2];return c("uncommitted_server_ahead"),[2];case 3:return c("other"),[2]}})})()},f.flush=function(){return(0,n._)(function(){return(0,l.YH)(this,function(e){switch(e.label){case 0:return[4,f.commitPromise];case 1:return e.sent(),f.debounceCommit(),f.debounceCommit.flush(),[4,f.commitPromise];case 2:return e.sent(),[2]}})})()},f.isFileSaved=function(){return!0},f.fetchOps=function(e,r){return(0,n._)(function(){var t;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(!f.channel)throw Error("No channel, cannot fetchOps");return[4,f.channel.request({otFetchRequest:{versionFrom:e,versionTo:r}})];case 1:if((t=n.sent()).channelClosed)throw Error("Channel closed while requesting");if(t.error)throw Error("Fetch ops returned an error: "+t.error);if(!t.otFetchResponse)throw Error("Expected otFetchResponse");if(!t.otFetchResponse.packets)throw Error("Expected otFetchResponse.packets");return[2,t.otFetchResponse.packets.map(function(e){var r=e.crc32,t=e.op,n=e.version,o=e.userId,i=e.committed,a=e.author;if(null==r)throw Error("Expected crc32 in packet");if(null==t)throw Error("Expected op in packet");if(null==n)throw Error("Expected version in packet");return{crc32:r,version:n,op:(0,P.K$)(t),userId:o,timestamp:i?1e3*i.seconds:0,author:a}})]}})})()},f.fetchChanges=function(e,r,t){return(0,n._)(function(){var n,o;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,f.fetchOps(e,r)];case 1:return n=i.sent(),o=t,[2,n.map(function(e){var r=e.op,t=e.version,n=e.userId,i=e.timestamp,a=e.crc32,s=(0,P.nD)(r,o),l=s.changes,c=s.docAfter,u=l.invert((0,P.G0)(o));return o=c,{changes:l,invertedChanges:u,userId:n,version:t,timestamp:i,crc32:a}})]}})})()},f.transformSelection=function(e){var r=e.indexStart,t=e.indexEnd,o=e.versionFrom,i=e.versionTo;return(0,n._)(function(){var e,n,a,s;return(0,l.YH)(this,function(l){switch(l.label){case 0:if(!f.channel)throw Error("No channel, cannot transformSelection");return[4,f.channel.request({otTransformSelectionRequest:{indexStart:r,indexEnd:t,versionFrom:o,versionTo:i}})];case 1:if(!(e=l.sent()).otTransformSelectionResponse)throw Error("Expected otTransformSelectionResponse");return[2,{indexStart:null!=(n=e.otTransformSelectionResponse.indexStart)?n:0,indexEnd:null!=(a=e.otTransformSelectionResponse.indexEnd)?a:0,version:null!=(s=e.otTransformSelectionResponse.version)?s:0}]}})})()},f.getLocalContent=function(){return(0,P.nq)(f.localContent)},f.getRawLocalContent=function(){return f.localContent},f.shouldTrackDataLoss=!1,f.replId="",f.linkedFile=e,f.channel=null,f.inflight=[],f.inflightOpsPromise=null,f.uncommittedOps=[],f.hasUncommittedMultiplayerOps=!1,f.committedVersion=-1,f.isReconnecting=!1,f.bufferedReconnectingOps=[],f.didEditOffline=!1,f.pending=[],f.metadata={},f.version=-1,f.serverContent="",f.localContent="",f.committedContent="",f.flushedCursorIds=[],f.pendingCursors=[],f.user=null,f.flushFailed=0,f.debounceSend=O()(function(){return f.sendOp()},20,{maxWait:60});var f,d=O()(function(){return f.commitToDisk()},1e3,{maxWait:3e3}),p=function(){if(!f.channel)throw Error("Tryna commit while offline");if(f.isReconnecting)throw Error("Committing while reconnecting");return d()};p.cancel=d.cancel,p.flush=d.flush,f.debounceCommit=p,f.commitPromise=null,f.timeDisconnected=null;var m=!1;return f.destroy=function(){m=!0},f.logger=s,f.track=u,f.dataloss=c,a.then(function(){m||(f.destroy=t.openChannel({service:"ot",name:"ot:".concat(e)},function(r){var t=r.channel,n=r.context;return f.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),f.replId=n.repl.id,f.dataloss&&f.shouldTrackDataLoss&&f.dataloss.ensureTrackedFile({replId:f.replId,filePath:e.toString()}),f.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,f.channel=t,t.onCommand(function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void f.onError("missing data in ot packet",{originalError:null,op:null==(r=e.ot)?void 0:r.op,spookyVersion:null==(t=e.ot)?void 0:t.spookyVersion,crc32:null==(n=e.ot)?void 0:n.crc32});if(-1===f.version)return;var r,t,n,o,i={crc32:e.ot.crc32,op:(0,P.K$)(e.ot.op),version:e.ot.spookyVersion,userId:null!=(o=e.ot.userId)?o:0};return f.handlePacket(i,{overrideReconnectingBuffer:!1});case"otstatus":return f.handleStatus(e.otstatus);case"error":if(e.ref)return;return f.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return f.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return f.handleDeleteCursor(e.otDeleteCursor)}}),function(){f.channel=null,f.isReconnecting=!0,f.debounceSend.cancel(),f.debounceCommit.cancel(),f.timeDisconnected||(f.timeDisconnected=Date.now())}}))}),f}return(0,F._)(r,e),r.prototype.commitToDisk=function(){return(0,n._)(function(){var e,r,t,n,o,i,a;return(0,l.YH)(this,function(s){switch(s.label){case 0:if(e=this,!this.channel)throw Error("Tryna commit while offline");if("open"!==this.channel.status)return[2];if(this.isReconnecting)throw Error("Committing while reconnecting");if(this.isClean())return[2];if(this.commitPromise)return this.debounceCommit(),[2];if(r=function(){},this.commitPromise=new Promise(function(e){return r=e}),!this.inflightOpsPromise)return[3,2];return[4,this.inflightOpsPromise];case 1:if(s.sent().channelClosed)return this.commitPromise=null,r(),[2];s.label=2;case 2:if(!(this.pending.length>0))return[3,4];if(this.debounceSend(),this.debounceSend.flush(),!this.inflightOpsPromise)return this.commitPromise=null,r(),this.onError("expected inflight promise",{originalError:null}),[2];return[4,this.inflightOpsPromise];case 3:if(s.sent().channelClosed)return this.commitPromise=null,r(),[2];s.label=4;case 4:return this.emit("commitStart"),t=this.version,n=this.serverContent,[4,this.channel.request({flush:{consistency:y.api.Flush.Consistency.Disk}})];case 5:if((o=s.sent()).channelClosed)return this.flushFailed=0,this.commitPromise=null,r(),[2];if("ok"!==o.body){if(this.commitPromise=null,r(),L(i=o.error||o.toString(),[Y.Tr.NotFound,Y.Tr.AlreadyExists,Y.Tr.NotDirectory,Y.Tr.IsDirectory,Y.Tr.DiskQuotaExceeded]))return this.onError("unable to flush",{originalError:i}),[2];return this.flushFailed++,setTimeout(function(){!e.isReconnecting&&e.channel&&"open"===e.channel.status&&e.debounceCommit()},Math.min(Math.random()*(Math.pow(2,this.flushFailed)-1)*1e3,1024e3)),[2]}return this.dataloss&&this.shouldTrackDataLoss&&(a=this.uncommittedOps[this.uncommittedOps.length-1])&&this.dataloss.storeOp({replId:this.replId,filePath:this.linkedFile.toString(),op:{crc32:a.crc32,version:a.version},opType:"latestFlushedOp",logger:this.logger,isReconnecting:this.isReconnecting}),this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=n,this.flushFailed=0,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,r(),[2,o]}})}).call(this)},r}(x.EventEmitter),q=t(87102);function U(e){var r,t=e.container,f=e.dataloss,d=e.track,p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,r=[];return{enqueue:function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];if(r.length>=e)throw Error("fs: We retried too many things during a closed channel.");return new Promise(function(e){r.push(e)}).then(function(){return t.apply(void 0,(0,s._)(o))})},flush:function(){r.splice(0,r.length).forEach(function(e){return e()})}}}(),T=p.enqueue,D=p.flush,k=!1,F=null,x=null,R=null,O=0,I=new Map,N=new Map,A=new Map,V=[],P=new Map,M=new Set;t.openChannel({service:"fsevents"},function(e){var r=e.channel;F=r,r.onCommand(function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a=(0,E.mc)(i);if(J(),I.get(a)||t.type===y.api.File.Type.DIRECTORY)s=Y.pt.Directory;else{var s,l,u=Array.from(I.keys()).find(function(e){return(0,E.aO)(e,a)}),f=u&&(null==(l=I.get(u))?void 0:l.children.find(function(e){return e.filename===(0,E.Yq)(a)}));s=f?f.type:Y.pt.File}switch(o){case y.api.FileEvent.Op.Create:K({eventType:Y.dV.Create,node:{path:a,type:s}});break;case y.api.FileEvent.Op.Modify:if(s===Y.pt.Directory){c.v4(function(e){e.setTag("service","fs"),e.setExtra("path-str",i),e.setExtra("op",o),e.setExtra("file-type",s),c.Cp(Error("Unexpected modify directory event"))});break}K({eventType:Y.dV.Modify,node:{path:a,type:s}});break;case y.api.FileEvent.Op.Remove:K({eventType:Y.dV.Delete,node:{path:a,type:s}});break;case y.api.FileEvent.Op.Move:if(null==n||null==n.path)throw Error("Expected dest path");var d=n.path;K({eventType:Y.dV.Move,node:{path:a,type:s},to:(0,E.mc)(d)})}}}}});var t=(0,s._)(new Set((0,s._)(I.keys()).concat((0,s._)(N.keys()),(0,s._)(A.keys()))));return t.length&&r.send({subscribeFile:{files:t.map(function(e){return{path:e.toString()}})}}),function(){F=null}});var q=new Promise(function(e){return r=e});t.openChannel({service:function(e){return e.repl.authorizations.editFileContents.isAuthorized?"gcsfiles":"files"}},function(e){var t=e.channel;r(t),D();var n=(0,s._)(I.keys()).sort(),o=!0,i=!1,a=void 0;try{for(var l,c=n[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)!function(){var e=l.value;et.readDir(e).then(function(r){var t=I.get(e);if(t){if(r.error)return void K({eventType:Y.dV.Delete,node:{path:e,type:Y.pt.Directory}});var n=r.children,o=t.children,i=o.filter(function(e){return!n.some(function(r){return r.filename===e.filename&&r.type===e.type})}),a=!0,s=!1,l=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var f=c.value;K({eventType:Y.dV.Delete,node:{path:(0,E.NE)(e,f.filename),type:f.type}})}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}var d=n.filter(function(e){return!o.some(function(r){return r.filename===e.filename&&r.type===e.type})}),h=!0,p=!1,v=void 0;try{for(var m,y=d[Symbol.iterator]();!(h=(m=y.next()).done);h=!0){var g=m.value;K({eventType:Y.dV.Create,node:{path:(0,E.NE)(e,g.filename),type:g.type}})}}catch(e){p=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw v}}}})}()}catch(e){i=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}var u=!0,f=!1,d=void 0;try{for(var h,p=A.keys()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0)!function(){var e=h.value;et.readFile(e,{fromDisk:!0}).then(function(r){var t=A.get(e);if(t){if(r.error)return void K({eventType:Y.dV.Delete,node:{path:e,type:Y.pt.File}});r.content.toBuffer().equals(t.latestContent.toBuffer())||K({eventType:Y.dV.Modify,node:{path:e,type:Y.pt.File}})}})}()}catch(e){f=!0,d=e}finally{try{u||null==p.return||p.return()}finally{if(f)throw d}}return function(){q=new Promise(function(e){return r=e})}});var U=(0,C.A)();U.promise.catch(function(e){return e});var B=(0,g.A)(function(){return(0,n._)(function(){var e;return(0,l.YH)(this,function(r){switch(r.label){case 0:return[4,U.promise];case 1:return[4,r.sent().request({fsSnapshot:{}})];case 2:if((e=r.sent()).channelClosed)return[2,{success:!1,error:"channel closed"}];if(e.error)return[2,{success:!1,error:e.error}];return[2,{error:null,success:!0}]}})})()},{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.authorizations.editFileContents.isAuthorized}},function(e){var r=e.channel;return U.resolve(r),function(){U.isFulfilled&&(U=(0,C.A)()).promise.catch(function(e){return e})}});var z=Y.sn.Clean,Q=[],$=0;function J(){return(0,n._)(function(){var e;return(0,l.YH)(this,function(r){switch(r.label){case 0:return $++,W(),[4,et.persist()];case 1:return(e=r.sent()).error&&u.vF.error("Failed to persist, something very bad has probably happened",{originalError:e.error}),$--,W(),[2]}})})()}function W(){return(0,n._)(function(){var e;return(0,l.YH)(this,function(r){return(e=0===$&&0===Z.length&&Array.from(N.values()).every(function(e){return e.otClient.isClean()}))===(z===Y.sn.Clean)||(z=e?Y.sn.Clean:Y.sn.Syncing,Q.forEach(function(e){e(z,{hasUserChanged:k})})),[2]})})()}var Z=[];function j(e){k=!0,Z.push(e),W(),e.then(function(){var r=Z.indexOf(e);r>-1&&Z.splice(r,1),J()})}function G(e,r){return(0,n._)(function(){var t,o;return(0,l.YH)(this,function(i){return o=(t=function(){return(0,n._)(function(){var r,n,o;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,q];case 1:if("open"!==(r=i.sent()).status)return[2,T(t)];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,r.request(e)];case 3:return n=i.sent(),[3,5];case 4:return o=i.sent(),c.Cp(Error("Send request failed with error: ".concat(o))),[2,T(t)];case 5:if(n.channelClosed)return[2,T(t)];return[2,n]}})})()})(),r.isMutative&&j(o),[2,o]})})()}function K(e){R=null;var r=(0,E.B$)(e.node.path),t=I.get(r),n=(0,E.Yq)(e.node.path);if(!n)throw Error("Expected filename");var a=null;if(e.eventType===Y.dV.Move){var l=(0,E.B$)(e.to);a=I.get(l)}if(t||a)switch(e.eventType){case Y.dV.Create:if(!t)break;var u=(0,s._)(t.children.filter(function(e){return e.filename!==n})).concat([{type:e.node.type,filename:n}]),f=!0,d=!1,h=void 0;try{for(var p,v=t.listeners[Symbol.iterator]();!(f=(p=v.next()).done);f=!0)(0,p.value.onChange)(u)}catch(e){d=!0,h=e}finally{try{f||null==v.return||v.return()}finally{if(d)throw h}}t.children=u;break;case Y.dV.Move:var m=(0,E.Yq)(e.to);if(t&&t===a){var y=(0,s._)(t.children.filter(function(e){return e.filename!==n&&e.filename!==m})).concat([{type:e.node.type,filename:m}]),g=!0,C=!1,w=void 0;try{for(var b,T=t.listeners[Symbol.iterator]();!(g=(b=T.next()).done);g=!0)(0,b.value.onChange)(y)}catch(e){C=!0,w=e}finally{try{g||null==T.return||T.return()}finally{if(C)throw w}}t.children=y;break}if(t){var _=t.children.filter(function(e){return e.filename!==n}),S=!0,D=!1,k=void 0;try{for(var F,x=t.listeners[Symbol.iterator]();!(S=(F=x.next()).done);S=!0)(0,F.value.onChange)(_)}catch(e){D=!0,k=e}finally{try{S||null==x.return||x.return()}finally{if(D)throw k}}t.children=_}if(a){var O=(0,s._)(a.children.filter(function(e){return e.filename!==n&&e.filename!==m})).concat([{type:e.node.type,filename:m}]),V=!0,P=!1,M=void 0;try{for(var L,H=a.listeners[Symbol.iterator]();!(V=(L=H.next()).done);V=!0)(0,L.value.onChange)(O)}catch(e){P=!0,M=e}finally{try{V||null==H.return||H.return()}finally{if(P)throw M}}a.children=O}break;case Y.dV.Delete:if(!t)break;var q=t.children.filter(function(e){return e.filename!==n}),U=!0,B=!1,z=void 0;try{for(var Q,$=t.listeners[Symbol.iterator]();!(U=(Q=$.next()).done);U=!0)(0,Q.value.onChange)(q)}catch(e){B=!0,z=e}finally{try{U||null==$.return||$.return()}finally{if(B)throw z}}t.children=q;break;case Y.dV.Modify:break;default:throw Error("unknown event")}switch(e.eventType){case Y.dV.Move:case Y.dV.Delete:var J=[N.get(e.node.path),A.get(e.node.path),I.get(e.node.path)],W=!0,Z=!1,j=void 0;try{for(var G,X=J[Symbol.iterator]();!(W=(G=X.next()).done);W=!0){var ee=G.value;if(ee){var er=!0,en=!1,eo=void 0;try{for(var ei,ea=ee.listeners[Symbol.iterator]();!(er=(ei=ea.next()).done);er=!0){var es=ei.value,el=es.onMoveOrDelete,ec=es.dispose;el&&el(e),ec()}}catch(e){en=!0,eo=e}finally{try{er||null==ea.return||ea.return()}finally{if(en)throw eo}}}}}catch(e){Z=!0,j=e}finally{try{W||null==X.return||X.return()}finally{if(Z)throw j}}if(e.node.type===Y.pt.File)break;var eu=(0,s._)(new Set((0,s._)(I.keys()).concat((0,s._)(A.keys()),(0,s._)(N.keys())))).map(function(e){var r=N.get(e)||A.get(e)||I.get(e);if(!r)throw Error("expected node");return r}),ef=[],ed=!0,eh=!1,ep=void 0;try{for(var ev,em=eu.sort()[Symbol.iterator]();!(ed=(ev=em.next()).done);ed=!0){var ey=ev.value;if((0,E.fG)(e.node.path,ey.path)){var eg=ef.slice(-1)[0];if(!(eg&&(0,E.fG)(eg,ey.path))){var eC={eventType:Y.dV.Delete,node:{path:ey.path,type:ey.type}};e.eventType===Y.dV.Move&&(eC=(0,i._)((0,o._)({},eC),{eventType:Y.dV.Move,to:(0,E.ju)(e.node.path,e.to,ey.path)})),ef.push(ey.path),K(eC)}}}}catch(e){eh=!0,ep=e}finally{try{ed||null==em.return||em.return()}finally{if(eh)throw ep}}break;case Y.dV.Create:case Y.dV.Modify:if(!A.has(e.node.path))break;et.readFile(e.node.path,{fromDisk:!0}).then(function(r){var t=A.get(e.node.path);if(t){if(r.error)return void K({eventType:Y.dV.Delete,node:{path:e.node.path,type:Y.pt.File}});t.latestContent=r.content;var n=!0,o=!1,i=void 0;try{for(var a,s=t.listeners[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value.onChange;l&&l(r.content)}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}}}).catch(function(e){e.message="File read after modify error: "+e.message,c.Cp(e)})}}function X(e){var r=!0,t=!1,n=void 0;try{for(var o,i=V[Symbol.iterator]();!(r=(o=i.next()).done);r=!0)(0,o.value)(e)}catch(e){t=!0,n=e}finally{try{r||null==i.return||i.return()}finally{if(t)throw n}}}var ee=function(e,r,t){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,n._)(function(){var i,a,s,c,u,f,d,p,v,m,y,g;function C(e){return(0,n._)(function(){var r;return(0,l.YH)(this,function(t){switch(t.label){case 0:return[4,i.request(e)];case 1:if((r=t.sent()).channelClosed)throw Error("channelClosed");if(r.error)throw Error(r.error);return[2,r]}})})()}return(0,l.YH)(this,function(n){switch(n.label){case 0:if(!o&&e===S.ob)return[2,{error:Y.Tr.InvalidPath}];return[4,q];case 1:i=n.sent(),a={eventType:Y.dV.Create,node:{path:e,type:Y.pt.File}},n.label=2;case 2:return n.trys.push([2,12,,13]),s=r.size,[4,C({transferStart:{path:e.toString(),size:s}})];case 3:if(!(c=n.sent().transfer))throw Error("Failed to start a transfer (no transfer id)");u=524288,t(s,0),f=0,d=0,p=void 0,v=void 0,n.label=4;case 4:if(!(f<s))return[3,10];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,(p=r.slice(f,f+u)).arrayBuffer()];case 6:return v=n.sent(),[3,8];case 7:throw n.sent(),new Y.tJ;case 8:return m=new Uint8Array(v),[4,C({transferChunk:{id:c.id,content:m}})];case 9:return n.sent(),d=h.buf(m,d),f+=p.size,t(s,f),[3,4];case 10:return[4,C({transferComplete:{id:c.id,crc32:d}})];case 11:return n.sent(),[3,13];case 12:if("channelClosed"===(y=n.sent()).message)return[2,T(et.transferFile,e,r,t)];if((g=L(y.message,[Y.Tr.NotDirectory,Y.Tr.AlreadyExists,Y.Tr.DiskQuotaExceeded,Y.Tr.NotReadable]))===Y.Tr.DiskQuotaExceeded&&X(a),g===Y.Tr.AlreadyExists&&(g=Y.Tr.IsDirectory),g)return[2,{error:g}];throw y;case 13:return K(a),[2,{error:null}]}})})()};function er(e){var r=new H(e,t,Promise.all((0,s._)(Z).map(function(e){return e.catch(function(){})})).then(function(){}),t.logger,f,d);return r.on("commitComplete",J),r.on("fileDirty",W),r.on("fileClean",W),r.on("commitStart",W),r}var et={getStatus:function(){return z},onStatusChange:function(e){return Q.push(e),function(){var r=Q.indexOf(e);r>-1&&Q.splice(r,1)}},watchDir:function(e,r){var t=!1,n=function(){t=!0;var r=I.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==n}),0===r.listeners.length&&I.delete(e))};return et.readDir(e).then(function(a){if(!t){if(a.error){var s=Error(a.error);s.code=a.error,r.onError(s),n();return}var l=I.get(e);!l&&(l={path:e,type:Y.pt.Directory,children:a.children,listeners:[]},I.set(e,l),F&&F.send({subscribeFile:{files:[{path:e.toString()}]}})),l.listeners.push((0,i._)((0,o._)({},r),{dispose:n})),r.onChange(a.children)}}).catch(function(e){n(),r.onError(e)}),n},watchPathStat:function(e,r){var t=0,n=!1,o=function(i,s,l){if(s===Y.pt.File)return function(){};var c=(0,a._)(l),u=c[0],f=c.slice(1),d=u===e;if(d&&0!==f.length)throw Error("Invariant: child is target but has more children");var h=null,p=et.watchDir(i,{onChange:function(i){var a=i.find(function(e){return e.filename===(0,E.Yq)(u)});if(!a){n||(r.onNewStat({exists:!1}),n=!0),h&&(h.dispose(),h=null);return}if(h&&a.type!==h.node.type&&(h.dispose(),h=null),!h){if(d){var s=++t;et.stat(e).then(function(e){s===t&&e.exists&&(r.onNewStat(e),n=!1,h={node:a,dispose:function(){}})});return}h={node:a,dispose:o(u,a.type,f)}}},onError:r.onError});return function(){null==h||h.dispose(),p()}},i=(0,a._)((0,E.q)(e)),s=i[0],l=i.slice(1);return o(s,Y.pt.Directory,l)},watchFilePath:function(e,r){var t,n=function(e,t){if(0===t.length){var o=et.watchFile((0,E.mc)(e),r);return function(){o()}}var i,a=t[0],s=!1,l=et.watchDir((0,E.mc)(e),{onChange:function(r){var o=r.find(function(e){return e.filename.toString()===a});if(!s&&o){i=n("".concat(e,"/").concat(a),t.slice(1)),s=!0;return}s=!1},onMoveOrDelete:function(){null==i||i()},onError:function(){}});return function(){null==i||i(),l()}},o=e.toString().split("/"),i=!1,a=et.watchDir((0,E.mc)(""),{onChange:function(e){var r=e.find(function(e){return e.filename.toString()===o[0]});if(!i&&r){t=n(o[0],o.slice(1)),i=!0;return}i=!1},onError:function(){}});return function(){null==t||t(),a()}},writeFile:function(e,r){return(0,n._)(function(){var t,n,o,i,a,s;return(0,l.YH)(this,function(l){switch(l.label){case 0:return n="string"==typeof r?w.A.from(r).toBuffer():r.toBuffer(),[4,G({write:{path:e.toString(),content:n}},{isMutative:!0})];case 1:if(o=l.sent(),a=null==(t=I.get((0,E.B$)(e)))?void 0:t.children.some(function(r){return r.filename===(0,E.Yq)(e)}),i=A.has(e)||N.has(e)||a?{eventType:Y.dV.Modify,node:{path:e,type:Y.pt.File}}:{eventType:Y.dV.Create,node:{path:e,type:Y.pt.File}},o.error){if((s=L(o.error,[Y.Tr.NotDirectory,Y.Tr.AlreadyExists,Y.Tr.DiskQuotaExceeded]))===Y.Tr.DiskQuotaExceeded&&X(i),s===Y.Tr.AlreadyExists&&(s=Y.Tr.IsDirectory),!s)throw Error(o.error);return[2,{error:s}]}return K(i),[2,{error:null}]}})})()},transferFile:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n._)(function(){var e;return(0,l.YH)(this,function(t){return j(e=ee.apply(void 0,(0,s._)(r))),[2,e]})})()},readFile:function(e){return(0,n._)(function(e){var r,t,n,o=arguments;return(0,l.YH)(this,function(i){switch(i.label){case 0:if(!(o.length>1&&void 0!==o[1]?o[1]:{fromDisk:!1}).fromDisk&&(r=N.get(e))&&r.otClient.getRawLocalContent()&&!r.otClient.isReconnecting)return[2,{content:w.A.from(r.otClient.getRawLocalContent()),error:null}];return[4,G({read:{path:e.toString()}},{isMutative:!1})];case 1:if((t=i.sent()).error){if(!(n=L(t.error,[Y.Tr.NotFound,Y.Tr.IsDirectory])))throw Error(t.error);return[2,{error:n}]}if(!t.file||!t.file.path||!t.file.content)throw Error("Expected file");return[2,{content:w.A.from(t.file.content),error:null}]}})}).apply(this,arguments)},createDir:function(e){return(0,n._)(function(){var r,t,n;return(0,l.YH)(this,function(o){switch(o.label){case 0:return[4,G({mkdir:{path:e.toString()}},{isMutative:!0})];case 1:if(r=o.sent(),t={eventType:Y.dV.Create,node:{path:e,type:Y.pt.Directory}},r.error){if((n=L(r.error,[Y.Tr.NotDirectory,Y.Tr.DiskQuotaExceeded]))===Y.Tr.DiskQuotaExceeded&&X(t),!n)throw Error(r.error);return[2,{error:n}]}return K(t),[2,{error:null}]}})})()},moveDir:function(e,r){return(0,n._)(function(){var t,n,o;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,G({move:{oldPath:e.toString(),newPath:r.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:Y.dV.Move,node:{path:e,type:Y.pt.Directory},to:r},t.error){if((o=L(t.error,[Y.Tr.NotFound,Y.Tr.AlreadyExists,Y.Tr.NotDirectory,Y.Tr.DiskQuotaExceeded]))===Y.Tr.DiskQuotaExceeded&&X(n),!o)throw Error(t.error);return[2,{error:o}]}return K(n),[2,{error:null}]}})})()},moveFile:function(e,r){return(0,n._)(function(){var t,n,o;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,G({move:{oldPath:e.toString(),newPath:r.toString()}},{isMutative:!0})];case 1:if(t=i.sent(),n={eventType:Y.dV.Move,node:{path:e,type:Y.pt.File},to:r},t.error){if((o=L(t.error,[Y.Tr.NotFound,Y.Tr.AlreadyExists,Y.Tr.NotDirectory,Y.Tr.DiskQuotaExceeded]))===Y.Tr.DiskQuotaExceeded&&X(n),!o)throw Error(t.error);return[2,{error:o}]}return K(n),[2,{error:null}]}})})()},copyFile:function(e,r){return(0,n._)(function(){var t;return(0,l.YH)(this,function(n){switch(n.label){case 0:return[4,et.readFile(e)];case 1:if((t=n.sent()).error)return[2,t];return[2,et.writeFile(r,t.content)]}})})()},copyDirFromRemote:function(e,r,t){return(0,n._)(function(){var n,o,i,a,s,c,u,f,d,h,p,v,m;return(0,l.YH)(this,function(l){switch(l.label){case 0:return[4,this.deleteDir(e)];case 1:return l.sent(),[4,t.readDir(e)];case 2:if((n=l.sent()).error)return[2,n];return[4,this.readDir(r)];case 3:if((o=l.sent()).error!==Y.Tr.NotFound)return[3,5];return[4,this.createDir(e)];case 4:return l.sent(),[3,6];case 5:if(o.error===Y.Tr.NotDirectory)return[2,o];l.label=6;case 6:i=!0,a=!1,s=void 0,l.label=7;case 7:l.trys.push([7,15,16,17]),c=n.children[Symbol.iterator](),l.label=8;case 8:if(i=(u=c.next()).done)return[3,14];if(f=u.value,d=(0,E.NE)(e,f.filename),f.type!==Y.pt.File)return[3,11];return[4,t.readFile(d)];case 9:if((h=l.sent()).error)return[2,h];return[4,this.writeFile((0,E.NE)(r,f.filename),h.content)];case 10:if((p=l.sent()).error)return[2,p];return[3,13];case 11:if(f.type!==Y.pt.Directory)return[3,13];return[4,this.copyDirFromRemote(d,(0,E.NE)(r,f.filename),t)];case 12:if((v=l.sent()).error)return[2,v];l.label=13;case 13:return i=!0,[3,8];case 14:return[3,17];case 15:return m=l.sent(),a=!0,s=m,[3,17];case 16:try{i||null==c.return||c.return()}finally{if(a)throw s}return[7];case 17:return[2,{error:null}]}})}).call(this)},copyFileFromRemote:function(e,r,t){return(0,n._)(function(){var n,o;return(0,l.YH)(this,function(i){switch(i.label){case 0:return[4,t.readFile(e)];case 1:if((n=i.sent()).error)return[2,n];return[4,this.writeFile(r,n.content)];case 2:if((o=i.sent()).error)return[2,o];return[2,{error:null}]}})}).call(this)},deleteFile:function(e){return(0,n._)(function(){var r,t;return(0,l.YH)(this,function(n){switch(n.label){case 0:return[4,G({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=L(r.error,[Y.Tr.NotFound])))throw Error(r.error);return[2,{error:t}]}return K({eventType:Y.dV.Delete,node:{path:e,type:Y.pt.File}}),[2,{error:null}]}})})()},deleteDir:function(e){return(0,n._)(function(){var r,t;return(0,l.YH)(this,function(n){switch(n.label){case 0:return[4,G({remove:{path:e.toString()}},{isMutative:!0})];case 1:if((r=n.sent()).error){if(!(t=L(r.error,[Y.Tr.NotFound])))throw Error(r.error);return[2,{error:t}]}return K({eventType:Y.dV.Delete,node:{path:e,type:Y.pt.Directory}}),[2,{error:null}]}})})()},readDir:function(e){return(0,n._)(function(){var r,t,n;return(0,l.YH)(this,function(o){switch(o.label){case 0:return[4,G({readdir:{path:e.toString()}},{isMutative:!1})];case 1:if((t=o.sent()).error){if(!(n=L(t.error,[Y.Tr.NotFound,Y.Tr.NotDirectory,Y.Tr.FileSystemUnavailable])))throw Error(t.error);return[2,{error:n}]}if(!(null==(r=t.files)?void 0:r.files))throw Error("Expected filesChannel");return[2,{children:t.files.files.map(function(e){if(!e.path)throw Error("Expected path");return{filename:(0,E.Yq)((0,E.mc)(e.path)),type:e.type===y.api.File.Type.DIRECTORY?Y.pt.Directory:Y.pt.File}}),error:null}]}})})()},stat:function(e){return(0,n._)(function(){var r;return(0,l.YH)(this,function(t){switch(t.label){case 0:return[4,G({stat:{path:e.toString()}},{isMutative:!1})];case 1:if((r=t.sent()).error)throw Error(r.error);if(!r.statRes)throw Error("expected stat result");if(!r.statRes.exists)return[2,{exists:!1}];if(r.statRes.type===y.api.File.Type.DIRECTORY)return[2,{exists:!0,type:Y.pt.Directory,lastModified:new Date(1e3*r.statRes.modTime)}];return[2,{exists:!0,type:Y.pt.File,lastModified:new Date(1e3*r.statRes.modTime),byteLength:Number(r.statRes.size)}]}})})()},watchTextFile:function(e,r){var t=this;if(!(0,E.Z1)(e)&&(0,E.jX)((0,E.mc)(e)))throw Error("Cannot watch root directory");var a=N.get(e);if(a||(a={path:e,type:Y.pt.File,listeners:[],otClient:er(e)},N.set(e,a)),!a)throw Error("Expected watchedOtFile");var c=!1,u=!1,f=function(){},d=[],h=function(o){if(f(),!a)throw Error("Expected watchedOtFile");var i,y=function(e){var t;return null==(t=r.onFlush)?void 0:t.call(r,e)};a.otClient.on("commitComplete",y);var g=function(){var e;return null==(e=r.onStatusChange)?void 0:e.call(r,Y.BM.Dirty)};a.otClient.on("fileDirty",g);var C=function(){var e;return null==(e=r.onStatusChange)?void 0:e.call(r,Y.BM.Clean)};a.otClient.on("fileClean",C);var w=function(){var e;return null==(e=r.onStatusChange)?void 0:e.call(r,Y.BM.Syncing)};a.otClient.on("commitStart",w);var E=function(e){var t;return null==(t=r.onCursor)?void 0:t.call(r,e)};a.otClient.on("cursor",E);var b=function(e){var t;return null==(t=r.onRemoveCursor)?void 0:t.call(r,e)};a.otClient.on("removeCursor",b);var T=function(e){var t;return null==(t=r.onFileSavedChanged)?void 0:t.call(r,e)};a.otClient.on("fileSavedChanged",T);var _=function(r){return(0,n._)(function(){var t,n,o,i,s,c,u,f,h,p,v,y;return(0,l.YH)(this,function(l){switch(l.label){case 0:if(!a)throw Error("Expected watchedOtFile");return(t=a.otClient).destroy(),n=er(e),[4,new Promise(function(e,r){n.once("changes",function(){return e()}),n.once("error",function(e){return r(e)})})];case 1:if(l.sent(),o=t.getLocalContent(),i=n.getLocalContent(),s="local"===r?(0,m.s)(i,o):null,c="remote"===r?(0,m.s)(o,i):null,!a)throw Error("Expected watchedOtFile");a.otClient=n,u=!0,f=!1,h=void 0;try{for(p=a.listeners[Symbol.iterator]();!(u=(v=p.next()).done);u=!0)(0,v.value.reregister)(c)}catch(e){f=!0,h=e}finally{try{u||null==p.return||p.return()}finally{if(f)throw h}}for(s&&n.writeChanges(s);d.length>0;)null==(y=d.pop())||y({isDisposed:!1});return[4,this.flush()];case 2:return l.sent(),[2]}})}).call(t)},S=function(e){var t;return null==(t=r.onReconnectFail)?void 0:t.call(r,_,e)};a.otClient.on("promptUserReconnect",S),a.listeners[0].reregister===h&&a.otClient.on("promptUserReconnect",function(){if(N.has(e)){if(!a)throw Error("Expected watchedOtFile");a.listeners.some(function(e){return e.onReconnectFail})||_("remote")}});var D=function(e,t){r.onError&&r.onError(e,t),p()};a.otClient.on("error",D);var F=function(t,n){if(t===Y.Tr.DiskQuotaExceeded&&X({eventType:Y.dV.Modify,node:{path:e,type:Y.pt.File}}),r.onError){var o=Error(n);o.code=t,r.onError(o)}p()};a.otClient.on("fsError",F);var x=function(e,t){if(!a)throw Error("Expected watchedOtFile");k=!0;var n=v.VR.of(e,a.otClient.getLocalContent().length,"\n");a.otClient.writeChanges(n,t);var o=!0,i=!1,s=void 0;try{for(var l,c=a.listeners[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var u=l.value.onChange;u&&u!==r.onChange&&u({changes:n,changeSource:Y.iC.Local,version:a.otClient.version,latestContent:a.otClient.getLocalContent()})}}catch(e){i=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw s}}},R=function(){return(0,n._)(function(){return(0,l.YH)(this,function(e){return(null==a?void 0:a.otClient.isReconnecting)?[2,new Promise(function(e,r){if(!a)return void r(Error("Expected watchedOtFile"));d.push(e)})]:[2,{isDisposed:c}]})})()},O=function(){for(;d.length>0;){var e;null==(e=d.pop())||e({isDisposed:!1})}};a.otClient.on("transparentReconnect",O);var I=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n._)(function(){var e,t;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(!a)throw Error("Expected watchedOtFile");n.label=1;case 1:return n.trys.push([1,3,,4]),[4,R()];case 2:if(n.sent().isDisposed)return[2,{isDisposed:!0,result:null}];return[3,4];case 3:if(t=n.sent(),c)return[2,{isDisposed:!0,result:null}];throw t;case 4:return[4,(e=a.otClient).fetchChanges.apply(e,(0,s._)(r))];case 5:return[2,{isDisposed:!1,result:n.sent()}]}})})()},A=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n._)(function(){var e;return(0,l.YH)(this,function(t){switch(t.label){case 0:if(!a)throw Error("Expected watchedOtFile");return[4,R()];case 1:if(t.sent().isDisposed)throw Error("File was disposed");return[2,(e=a.otClient).transformSelection.apply(e,(0,s._)(r))]}})})()},V=function(e){if(!a)throw Error("Expected watchedOtFile");a.otClient.updateCursors(e)};-1!==a.otClient.version&&setTimeout(function(){var e;if(!u){if(!a)throw Error("Expected watchedOtFile");u=!0,null==(e=r.onReady)||e.call(r,{initialContent:a.otClient.getLocalContent(),writeChange:x,updateSelections:V,fetchChanges:I,transformSelection:A,version:a.otClient.version})}}),o&&(null==(i=r.onChange)||i.call(r,{changes:o,changeSource:Y.iC.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent(),userId:0}));var P=function(e,t){var n,o;if(!a)throw Error("Expected watchedOtFile");if(!u){u=!0,null==(o=r.onReady)||o.call(r,{initialContent:a.otClient.getLocalContent(),writeChange:x,updateSelections:V,fetchChanges:I,transformSelection:A,version:a.otClient.version});return}null==(n=r.onChange)||n.call(r,{changes:e,changeSource:Y.iC.Container,version:a.otClient.version,latestContent:a.otClient.getLocalContent(),userId:t})};a.otClient.on("changes",P),f=function(){if(!a)throw Error("Expected watchedOtFile");a.otClient.removeListener("commitComplete",y),a.otClient.removeListener("fileDirty",g),a.otClient.removeListener("fileClean",C),a.otClient.removeListener("commitStart",w),a.otClient.removeListener("error",D),a.otClient.removeListener("fsError",F),a.otClient.removeListener("changes",P),a.otClient.removeListener("cursor",E),a.otClient.removeListener("removeCursor",b),a.otClient.removeListener("promptUserReconnect",S),a.otClient.removeListener("transparentReconnect",O),a.otClient.removeListener("fileSavedChanged",T)},W()},p=function(){for(;d.length>0;){var r;null==(r=d.pop())||r({isDisposed:!0})}if(!c&&N.has(e)){if(c=!0,u=!0,f(),!a)throw Error("Expected watchedOtFile");a.listeners=a.listeners.filter(function(e){return e.dispose!==p}),0===a.listeners.length&&(a.otClient.destroy(),N.delete(e))}};return a.listeners.push((0,i._)((0,o._)({},r),{dispose:p,reregister:h})),h(null),p},watchFile:function(e,r){if(!(0,E.Z1)(e)&&(0,E.jX)((0,E.mc)(e)))throw Error("Cannot watch root directory");var t=!1,n=function(){t=!0;var r=A.get(e);r&&(r.listeners=r.listeners.filter(function(e){return e.dispose!==n}),0===r.listeners.length&&A.delete(e))};return et.readFile(e).then(function(a){if(!t){if(a.error){var s=Error(a.error);s.code=a.error,r.onError&&r.onError(s),n();return}var l=A.get(e);if(!l&&(l={path:e,type:Y.pt.File,listeners:[],latestContent:a.content},A.set(e,l),F&&F.send({subscribeFile:{files:[{path:e.toString()}]}})),!l)throw Error("Expected watched file");l.listeners.push((0,i._)((0,o._)({},r),{dispose:n})),r.onChange(a.content)}}),n},listFiles:function(){return(0,n._)(function(){var e;return(0,l.YH)(this,function(r){switch(r.label){case 0:if(R&&t.performance.now()-O<1e4)return[2,R];return x||(x=(0,n._)(function(){var e,r,n,o,i;return(0,l.YH)(this,function(a){switch(a.label){case 0:return[4,(e=t).execImmediately.apply(e,["rg","--hidden","--files"].concat((0,s._)(_.TJ.flatMap(function(e){return["--glob","!".concat(e)]}))))];case 1:if(n=(r=a.sent()).output,o=r.error,i=function(e){return!(!e||(0,_.RZ)(e))},!o&&n)return[2,R={error:null,files:n.split("\n").filter(i)}];if("exit status 1"===o)return[2,R={error:null,files:[]}];return c.Cp(Error("Find file command failed with error: ".concat(o))),[2,{error:o,files:null}]}})})(),O=t.performance.now()),[4,x];case 1:return e=r.sent(),x=null,[2,e]}})})()},flush:function(e){return(0,n._)(function(e){var r,t,o,i,a,s,c,u,f,d,h,p,v,m,y,g,C,w,E,b,T,_,S,D,k,F,x,R,O,I,A,V,L,H,q,U,B,z,Q,$,J,W,j,G,K,X=arguments;return(0,l.YH)(this,function(ee){switch(ee.label){case 0:if(r=X.length>1&&void 0!==X[1]?X[1]:Y.sT.UNKNOWN,t=function(e){return(0,n._)(function(){var t,n,o,i,a,s,c,u;return(0,l.YH)(this,function(l){switch(l.label){case 0:if(t=e.path,!(n=P.get(t)))return[2];o=!0,i=!1,a=void 0,l.label=1;case 1:l.trys.push([1,6,7,8]),s=n[Symbol.iterator](),l.label=2;case 2:if(o=(c=s.next()).done)return[3,5];return[4,(0,c.value)(e.otClient.getLocalContent(),r)];case 3:l.sent(),l.label=4;case 4:return o=!0,[3,2];case 5:return[3,8];case 6:return u=l.sent(),i=!0,a=u,[3,8];case 7:try{o||null==s.return||s.return()}finally{if(i)throw a}return[7];case 8:return[2]}})})()},o=function(e){var t=e.path,n=!0,o=!1,i=void 0;try{for(var a,s=M[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)(0,a.value)(t,r)}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}},i=[],a=function(e){null===e.otClient.channel||e.otClient.isReconnecting||i.push(e.otClient.flush())},void 0!==e)return[3,9];s=!0,c=!1,u=void 0,ee.label=1;case 1:ee.trys.push([1,6,7,8]),f=N.values()[Symbol.iterator](),ee.label=2;case 2:if(s=(d=f.next()).done)return[3,5];return h=d.value,[4,t(h)];case 3:ee.sent(),ee.label=4;case 4:return s=!0,[3,2];case 5:return[3,8];case 6:return p=ee.sent(),c=!0,u=p,[3,8];case 7:try{s||null==f.return||f.return()}finally{if(c)throw u}return[7];case 8:v=!0,m=!1,y=void 0;try{for(g=N.values()[Symbol.iterator]();!(v=(C=g.next()).done);v=!0)w=C.value,a(w)}catch(e){m=!0,y=e}finally{try{v||null==g.return||g.return()}finally{if(m)throw y}}return[3,18];case 9:E=!0,b=!1,T=void 0,ee.label=10;case 10:ee.trys.push([10,15,16,17]),_=e[Symbol.iterator](),ee.label=11;case 11:if(E=(S=_.next()).done)return[3,14];if(D=S.value,void 0===(k=N.get(D)))return[3,13];return[4,t(k)];case 12:ee.sent(),ee.label=13;case 13:return E=!0,[3,11];case 14:return[3,17];case 15:return p=ee.sent(),b=!0,T=p,[3,17];case 16:try{E||null==_.return||_.return()}finally{if(b)throw T}return[7];case 17:F=!0,x=!1,R=void 0;try{for(O=e[Symbol.iterator]();!(F=(I=O.next()).done);F=!0)A=I.value,V=N.get(A),void 0!==V&&a(V)}catch(e){x=!0,R=e}finally{try{F||null==O.return||O.return()}finally{if(x)throw R}}ee.label=18;case 18:return ee.trys.push([18,20,,21]),[4,Promise.all(i.concat(Z))];case 19:if(ee.sent(),void 0===e){L=!0,H=!1,q=void 0;try{for(U=N.values()[Symbol.iterator]();!(L=(B=U.next()).done);L=!0)z=B.value,o(z)}catch(e){H=!0,q=e}finally{try{L||null==U.return||U.return()}finally{if(H)throw q}}}else{Q=!0,$=!1,J=void 0;try{for(W=e[Symbol.iterator]();!(Q=(j=W.next()).done);Q=!0)G=j.value,K=N.get(G),void 0!==K&&o(K)}catch(e){$=!0,J=e}finally{try{Q||null==W.return||W.return()}finally{if($)throw J}}}return[3,21];case 20:return ee.sent(),[3,21];case 21:return[2]}})}).apply(this,arguments)},registerOnBeforeFlush:function(e,r){var t,n=null!=(t=P.get(e))?t:new Set;return n.add(r),P.set(e,n),function(){var t;return null==(t=P.get(e))?void 0:t.delete(r)}},registerOnFlushSuccess:function(e){return M.add(e),function(){M.delete(e)}},persist:function(e){var r=B();return e&&e.skipDebounce&&B.flush(),r},getOTVersion:function(e){if("SYNTHETIC_FILE_PATH.sql"===e)return 123;var r=N.get(e);if(!r)throw Error("No file with path ".concat(e," found."));return r.otClient.version},isFileOrDirSaved:function(e){if((0,b.m6)(e)){var r=N.get(e);return!r||r.otClient.isFileSaved()}return!0},onDiskQuotaExceeded:function(e){return V.push(e),function(){V=V.filter(function(r){return r!==e})}}};return et}var B=f.ZU.Object({cluster:f.ZU.String(),sourceRepl:f.ZU.String(),zipperToken:f.ZU.String(),expirySeconds:f.ZU.Number()});function z(e){return(0,n._)(function(e){var r,t,n,o,i,a,s,c,u,f,h,v,m;return(0,l.YH)(this,function(l){switch(l.label){case 0:return r=e.replId,[4,(0,e.getCaptcha)()];case 1:return n=(t=l.sent()).isEmbed,o=t.hCaptchaSiteKey,i=t.recaptchaToken,a={captcha:t.captcha,isEmbed:n,hCaptchaSiteKey:o,recaptchaToken:i,asViewer:!0},[4,fetch("/data/repls/".concat(r,"/get_zipper_token"),{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify(a)})];case 2:if(!(s=l.sent()).ok)throw Error("Failed to get zipper token: ".concat(s.status," ").concat(s.statusText));return[4,s.json()];case 3:if(c=l.sent(),!d.J(B,c))throw(0,q.$J)(B,c);return u=c.cluster,f=c.sourceRepl,h=c.zipperToken,v=c.expirySeconds,m=(0,p.A)(new Date,v-10),[2,{sourceReplId:f,baseUrl:(0,T.ev)(u),token:h,exp:m}]}})}).apply(this,arguments)}function Q(e){var r,t=e.replId,i=e.getCaptcha;function a(){return(0,n._)(function(){var e;return(0,l.YH)(this,function(n){switch(n.label){case 0:if(e=!r)return[3,2];return[4,r];case 1:e=n.sent().exp.getTime()<=new Date().getTime(),n.label=2;case 2:return e&&(r=z({replId:t,getCaptcha:i})),[4,r];case 3:return[2,n.sent()]}})})()}var s={watchDir:function(e,r){return s.readDir(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.children)}),function(){}},watchFile:function(e,r){return s.readFile(e).then(function(e){if(e.error){var t=Error(e.error);t.code=e.error,r.onError&&r.onError(t);return}return r.onChange(e.content)}),function(){}},stat:function(e){return(0,n._)(function(){var r;return(0,l.YH)(this,function(t){switch(t.label){case 0:return[4,s.readFile(e)];case 1:if((r=t.sent()).error)switch(r.error){case Y.Tr.NotFound:return[2,{exists:!1}];case Y.Tr.IsDirectory:return[2,{exists:!0,type:Y.pt.Directory,lastModified:new Date}]}return[2,{exists:!0,type:Y.pt.File,byteLength:r.content.length,lastModified:new Date}]}})})()},readDir:function(e){return(0,n._)(function(){var r,t,n,i,s,c,u;return(0,l.YH)(this,function(l){switch(l.label){case 0:return[4,a()];case 1:return t=(r=l.sent()).sourceReplId,n=r.baseUrl,i=r.token,[4,fetch("".concat(n,"/repls/").concat(t,"/files/dir?path=").concat(e),(0,o._)({},i&&{headers:{Authorization:"Bearer ".concat(i)}}))];case 2:if(!(s=l.sent()).ok)return[3,4];return[4,s.json()];case 3:return[2,{children:null!=(c=l.sent())?c:[],error:null}];case 4:return[4,s.text()];case 5:if(u=l.sent(),404===s.status&&"file not found"===u)return[2,{error:Y.Tr.NotFound}];if(400===s.status&&"file is not a directory"===u)return[2,{error:Y.Tr.NotDirectory}];throw Error("Error when trying to read dir through zipper, status: ".concat(s.status,", body: ").concat(u));case 6:return[2]}})})()},readFile:function(e,r){return(0,n._)(function(){var r,t,n,i,s,c,u,f;return(0,l.YH)(this,function(l){switch(l.label){case 0:return[4,a()];case 1:return t=(r=l.sent()).sourceReplId,n=r.baseUrl,i=r.token,[4,fetch("".concat(n,"/repls/").concat(t,"/files/file?path=").concat(encodeURIComponent(e)),(0,o._)({},i&&{headers:{Authorization:"Bearer ".concat(i)}}))];case 2:if(!(s=l.sent()).ok)return[3,4];return c={},u=w.A.bind,[4,s.arrayBuffer()];case 3:return[2,(c.content=new(u.apply(w.A,[void 0,l.sent()])),c.error=null,c)];case 4:return[4,s.text()];case 5:if(f=l.sent(),404===s.status&&"file not found"===f)return[2,{error:Y.Tr.NotFound}];if(400===s.status&&"file is a directory"===f)return[2,{error:Y.Tr.IsDirectory}];throw Error("Error when trying to read file through zipper, status: ".concat(s.status,", body: ").concat(f));case 6:return[2]}})})()}};return s}},82167:(e,r,t)=>{t.d(r,{ev:()=>a,pI:()=>i});var n=t(73920),o=t(60594).Buffer;function i(e){var r=e.split(".");if(4!==r.length)throw Error("Invalid token: should have exactly 4 parts: "+e);for(var t=r[2].replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var i=window.atob(t);if(i.length<64)throw Error("Invalid token: signed part is too short: "+i.length);var a=i.substring(0,i.length-64);return n.api.token.ReplToken.decode(o.from(a,"base64"))}function a(e){var r,t=null!=(r=({"infra-staging":"platform-infra-staging",mark:"platform-replit"})[e])?r:"platform";return"https://zipper.".concat(e,".").concat(t,".replit.com")}},96367:(e,r,t)=>{t.d(r,{$1:()=>s,G0:()=>f,K$:()=>a,RV:()=>i,nD:()=>l,nq:()=>u});var n=t(22531),o=t(49069);function i(e){return e.map(function(e){return(void 0===e?"undefined":(0,n._)(e))==="object"?{delete:e.d}:"number"==typeof e?{skip:e}:{insert:e}})}function a(e){return e.map(function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"==typeof e.insert)return e.insert;throw Error("Unexpected op type")})}function s(e,r){var t=[],n=r,o=0,i=0,a=0,s=0,l=function(e){var t=e-i;if(e<i)throw Error("expected changeset to be ordered");for(var n=i+a;n<i+t+a;n++){var o=r.charCodeAt(n);o>=55296&&o<=57343?(s++,n++):13===o&&10===r.charCodeAt(n+1)&&(a++,n++)}i+=t};return e.iterChanges(function(e,r,c,u,f){if(e>0){var d=i+a,h=d-s;l(e);var p=i+a,v=p-s;t.push(v-h),o+=p-d}if(e!==r){var m=i+a,y=m-s;l(r);var g=i+a,C=g-s;t.push({d:C-y}),n=n.slice(0,o)+n.slice(o+(g-m))}if(f.length){var w=f.sliceString(0);t.push(w),n=n.slice(0,o)+w+n.slice(o),o+=w.length}}),{op:t,docAfter:n}}function l(e,r){var t=[],n=r,i=0,a=0,s=0,l=0,c=function(e){for(var t=a+s;t<a+e+s;t++){var n=r.charCodeAt(t);n>=55296&&n<=57343?(s++,t++):13===n&&10===r.charCodeAt(t+1)&&(l++,t++)}a+=e},u=!0,d=!1,h=void 0;try{for(var p,v,m=e[Symbol.iterator]();!(u=(v=m.next()).done);u=!0){var y=v.value;if("string"==typeof y){var g=y;n=n.slice(0,i)+g+n.slice(i),i+=g.length;var C=a+s;if(g.endsWith("\r")&&"\n"===r.slice(C,C+1)&&(g=g.slice(0,-1),0===g.length))continue;var w=f(g),E=C-l;(null==p?void 0:p.to)===E?p.insert=p.insert?p.insert.append(w):w:(p={from:C-l,insert:w},t.push(p))}else if("number"==typeof y){var b=s;c(y);var T=s-b;i+=y+T}else if("d"in y){var _=a+s,S=l;c(y.d);var D=a+s,k=D-_;n=n.slice(0,i)+n.slice(i+k);var F=_-S,x=D-l;if("\r\n"===r.slice(_-1,_+1)&&(F+=1,(x-=1)-F<=0))continue;(null==p?void 0:p.to)===F?p.to=x:(p={from:F,to:x},t.push(p))}}}catch(e){d=!0,h=e}finally{try{u||null==m.return||m.return()}finally{if(d)throw h}}if(a+s!==r.length){var R=r.slice(a+s);l+=R.split("\r\n").length-1}return{changes:o.VR.of(t,r.length-l),docAfter:n}}var c=/\r\n?|\n/;function u(e){return e.replaceAll("\r\n","\n").replaceAll("\r","\n")}function f(e){return o.EY.of(e.split(c))}}}]);
//# sourceMappingURL=7276-7da6ffdcfff2f5fe.js.map